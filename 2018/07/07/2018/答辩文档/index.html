<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>世界电影大数据分析 | LiuHDme</title>
  <meta name="author" content="LiuHDme">
  
  <meta name="description" content="学校组织了为期 20 天的实训，老实说，这次实训的收获真比我想象中大很多，这篇文章是我们小组完成的实训项目的报告。">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="世界电影大数据分析"/>
  <meta property="og:site_name" content="LiuHDme"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/favicon.png" rel="icon">
  

  <!-- CSS -->
  <link rel="stylesheet" href="/css/themes/cerulean.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight-default.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/comment.css" media="screen" type="text/css">
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.7/es5-sham.min.js"></script>
  <![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>
  
  <!-- analytics -->
  



<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <nav id="main-nav" class="navbar navbar-inverse navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
	<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
       <a class="navbar-brand" href="/">LiuHDme</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>归档
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class="fa fa-folder"></i>分类
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class="fa fa-tags"></i>标签
			</a>
		  </li>
		  
		  <li>
			<a href="/photos" title="">
			  <i class=""></i>相册
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>关于
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
    <div class="content">
      


	
		<div class="page-header page-header-inverse ">		
			<h1 class="title title-inverse "> 世界电影大数据分析</h1>
		</div>		
	






<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <p>学校组织了为期 20 天的实训，老实说，这次实训的收获真比我想象中大很多，这篇文章是我们小组完成的实训项目的报告。</p>
<a id="more"></a>
<h1 id="数据源地址"><a href="#数据源地址" class="headerlink" title="数据源地址"></a>数据源地址</h1><p><a target="_blank" rel="noopener" href="http://wangjunle23.blog.163.com/blog/static/117838171201411304124368/">http://wangjunle23.blog.163.com/blog/static/117838171201411304124368/</a></p>
<h1 id="数据集描述"><a href="#数据集描述" class="headerlink" title="数据集描述"></a>数据集描述</h1><p>该数据集（ML20M）描述了来自 MOVELELN 的5星级评级和免费文本标记活动。它包含20000263个评级和465564个标签，横跨27278部电影。这些数据是由138493 个用户在 1995 年和 2015 年 3 月 31 日之间创建的。这个数据集是在 2015 年 3 月 31 日生成的，并在 2016 年 10 月 17 日更新以更新 Link .CSV 。用户随机选择纳入。所有选定的用户至少有 20 部电影，没有人口统计信息包括在内，每个用户由 ID 表示，并且不提供其他信息。</p>
<h1 id="数据字典"><a href="#数据字典" class="headerlink" title="数据字典"></a>数据字典</h1><div class="table-container">
<table>
<thead>
<tr>
<th><strong>编号</strong></th>
<th><strong>名称</strong></th>
<th><strong>数据类型</strong></th>
<th><strong>数据格式</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>标签</td>
<td>string</td>
<td>字符串格式</td>
</tr>
<tr>
<td>2</td>
<td>标签Id</td>
<td>int</td>
<td>普通整数格式</td>
</tr>
<tr>
<td>3</td>
<td>标签相关性</td>
<td>float</td>
<td>普通浮点数格式</td>
</tr>
<tr>
<td>4</td>
<td>电影Id</td>
<td>int</td>
<td>普通整数格式</td>
</tr>
<tr>
<td>5</td>
<td>Imdb网站上的Id号</td>
<td>int</td>
<td>普通整数格式</td>
</tr>
<tr>
<td>6</td>
<td>Themoviedb网站上的Id号</td>
<td>int</td>
<td>普通整数格式</td>
</tr>
<tr>
<td>7</td>
<td>电影名</td>
<td>string</td>
<td>字符串格式</td>
</tr>
<tr>
<td>8</td>
<td>电影流派</td>
<td>string</td>
<td>字符串格式</td>
</tr>
<tr>
<td>9</td>
<td>用户Id</td>
<td>int</td>
<td>普通整数格式</td>
</tr>
<tr>
<td>10</td>
<td>评级分数</td>
<td>float</td>
<td>普通浮点数格式</td>
</tr>
<tr>
<td>11</td>
<td>时间戳</td>
<td>int</td>
<td>普通整数格式</td>
</tr>
</tbody>
</table>
</div>
<h1 id="项目分析要点"><a href="#项目分析要点" class="headerlink" title="项目分析要点"></a>项目分析要点</h1><h2 id="关于流派"><a href="#关于流派" class="headerlink" title="关于流派"></a>关于流派</h2><h3 id="每种流派电影的数量"><a href="#每种流派电影的数量" class="headerlink" title="每种流派电影的数量"></a>每种流派电影的数量</h3><p>根据文件movies进行处理，分析所有电影流派的电影数，比较哪种流派电影多，哪种电影流派少。</p>
<h4 id="数据处理"><a href="#数据处理" class="headerlink" title="数据处理"></a>数据处理</h4><p>主要语句如下：</p>
<ol>
<li><p><strong>将预先处理过的数据采集到HDFS中</strong>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -put &#x2F;home&#x2F;cloudera&#x2F;Desktop&#x2F;movies.txt &#x2F;data&#x2F;movies &#x2F;&#x2F; 将目标文件拷贝在虚拟机的data目录下</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p><strong>创建相应的数据库表，将数据导入数据库表中：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> movies(</span><br><span class="line">    movieId <span class="type">int</span>,</span><br><span class="line">    title String,</span><br><span class="line">    genres STRING</span><br><span class="line">)</span><br><span class="line"><span class="type">ROW</span> FORMAT DELIMITED FIELDS TERMINATED <span class="keyword">BY</span><span class="string">&#x27;&#123;&#x27;</span></span><br><span class="line">LINES TERMINATED <span class="keyword">BY</span>&quot;\n&quot;</span><br><span class="line">stored <span class="keyword">as</span> textfile</span><br><span class="line">location &quot;/data/movies&quot;;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="利用HUE对movies数据库表中的数据进行绘制。"><a href="#利用HUE对movies数据库表中的数据进行绘制。" class="headerlink" title="利用HUE对movies数据库表中的数据进行绘制。"></a>利用HUE对movies数据库表中的数据进行绘制。</h4><ol>
<li><p><strong>SQL查询语句</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">count</span>(<span class="keyword">case</span> <span class="keyword">when</span> genres rlike &quot;Comedy&quot; <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">end</span>)Comedy,</span><br><span class="line">       <span class="built_in">count</span>(<span class="keyword">case</span> <span class="keyword">when</span> genres rlike &quot;Action&quot; <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">end</span>)Action,</span><br><span class="line">       <span class="built_in">count</span>(<span class="keyword">case</span> <span class="keyword">when</span> genres rlike &quot;Adventure&quot; <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">end</span>)Adventure,</span><br><span class="line">       <span class="built_in">count</span>(<span class="keyword">case</span> <span class="keyword">when</span> genres rlike &quot;Animation&quot; <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">end</span>)Animation,</span><br><span class="line">       <span class="built_in">count</span>(<span class="keyword">case</span> <span class="keyword">when</span> genres rlike &quot;Children&quot; <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">end</span>)Children,</span><br><span class="line">       <span class="built_in">count</span>(<span class="keyword">case</span> <span class="keyword">when</span> genres rlike &quot;Drama&quot; <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">end</span>)Drama,</span><br><span class="line">       <span class="built_in">count</span>(<span class="keyword">case</span> <span class="keyword">when</span> genres rlike &quot;Romance&quot; <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">end</span>)Romance,</span><br><span class="line">       <span class="built_in">count</span>(<span class="keyword">case</span> <span class="keyword">when</span> genres rlike &quot;Crime&quot; <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">end</span>)Crime,</span><br><span class="line">       <span class="built_in">count</span>(<span class="keyword">case</span> <span class="keyword">when</span> genres rlike &quot;Thriller&quot; <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">end</span>)Thriller,</span><br><span class="line">       <span class="built_in">count</span>(<span class="keyword">case</span> <span class="keyword">when</span> genres rlike &quot;Horror&quot; <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">end</span>)Horror,</span><br><span class="line">       <span class="built_in">count</span>(<span class="keyword">case</span> <span class="keyword">when</span> genres rlike &quot;Mystery&quot; <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">end</span>)Mystery,</span><br><span class="line">       <span class="built_in">count</span>(<span class="keyword">case</span> <span class="keyword">when</span> genres rlike &quot;Sci-Fi&quot; <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">end</span>)SciFi,</span><br><span class="line">       <span class="built_in">count</span>(<span class="keyword">case</span> <span class="keyword">when</span> genres rlike &quot;IMAX&quot; <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">end</span>)IMAX,</span><br><span class="line">       <span class="built_in">count</span>(<span class="keyword">case</span> <span class="keyword">when</span> genres rlike &quot;Documentary&quot; <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">end</span>)Documentary,</span><br><span class="line">       <span class="built_in">count</span>(<span class="keyword">case</span> <span class="keyword">when</span> genres rlike &quot;Musical&quot; <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">end</span>)Musical,</span><br><span class="line">       <span class="built_in">count</span>(<span class="keyword">case</span> <span class="keyword">when</span> genres rlike &quot;Fantasy&quot; <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">end</span>)Fantasy,</span><br><span class="line">       <span class="built_in">count</span>(<span class="keyword">case</span> <span class="keyword">when</span> genres rlike &quot;War&quot; <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">end</span>)War,</span><br><span class="line">       <span class="built_in">count</span>(<span class="keyword">case</span> <span class="keyword">when</span> genres rlike &quot;Film-Noir&quot; <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">end</span>)FilmNoir <span class="keyword">from</span> movies;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><strong>查询结果</strong></li>
</ol>
<p><img src="http://oom3nz471.bkt.clouddn.com/2.jpg" alt="img"> </p>
<p><img src="http://oom3nz471.bkt.clouddn.com/3.jpg" alt="img"> </p>
<p><img src="http://oom3nz471.bkt.clouddn.com/4.jpg" alt="img"> </p>
<h4 id="分析结果"><a href="#分析结果" class="headerlink" title="分析结果"></a><strong>分析结果</strong></h4><p>从各流派电影数图来看，电影数最多的是Drama类，电影数最少的是IMAX类。我们猜测，IMAX技术出现比较晚，受年代限制所以这类电影数量比较少，除IMAX类之外最少的是Film-Noir（黑色电影）类。</p>
<h3 id="各流派得分随时间的变化"><a href="#各流派得分随时间的变化" class="headerlink" title="各流派得分随时间的变化"></a>各流派得分随时间的变化</h3><h4 id="分析思路"><a href="#分析思路" class="headerlink" title="分析思路"></a>分析思路</h4><p>工具：Spark</p>
<p>这个角度稍微复杂了一些，但主体思路不难，大致为如下流程：</p>
<ol>
<li><p>首先，我将 moives.csv 表和 ratings.csv 表用他们共有的元素 movieId 建立起联系，得到如下所示的列表：</p>
<blockquote>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fzhvwnt2zyj308b0a8gm4.jpg" alt=""></p>
</blockquote>
<p>其中，为了方便，value 中的第一个元素的第二个元素为该电影诞生年份距 1890 年的以 20 年为一个单位的数目，写一个用来解析年份的函数并调用即可。</p>
</li>
<li><p>然后，通过另外一个解析函数将每一行的流派拆开并和后面剩下的元素单独组合，形成以“流派 + 年份”为 Key，分数为 Value 的 RDD（丢弃 movieId，之后用不到这个元素了），再通过 ReduceByKey 将相同的 Key 组合，Value 相加，同时统计次数，可形成以下形式的列表：</p>
<blockquote>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fzhvwx0uqej304b02owed.jpg" alt=""></p>
</blockquote>
</li>
<li><p>算出每一项的平均分后，将年份单独作为 Key，用 ReduceByKey 将 Key 相同的组合在一起，Value 依次相加，组合成该年代下的“（流派，得分）”列表，即如下所示：</p>
<blockquote>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fzhvxctgy0j30960873yd.jpg" alt=""></p>
</blockquote>
<p>每个年代的流派和得分信息便可得出了，之后作出图表即可进行分析</p>
</li>
</ol>
<h4 id="图表分析"><a href="#图表分析" class="headerlink" title="图表分析"></a>图表分析</h4><p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fzhvy3h7n6j30zk0g4jx9.jpg" alt=""></p>
<p>结论：上图包含了很多信息，可以从很多角度进行分析。比如，恐怖片的质量看上去越来越差强人意了，犯罪主题的电影似乎也越来越不合人的胃口，但又比恐怖片好一些。纪录片似乎质量一直不错，枪战片的质量在上世纪七八十年代似乎很不错，另外，似乎所有流派的电影质量都有所下滑，这也许是人们已经厌倦了现代的好莱坞式商业电影大行于世导致的。</p>
<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.&#123;<span class="type">SparkConf</span>, <span class="type">SparkContext</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">    <span class="keyword">val</span> conf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">&quot;WordCount&quot;</span>).setMaster(<span class="string">&quot;local&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(conf)</span><br><span class="line">    <span class="keyword">val</span> lines1 = sc.textFile(<span class="string">&quot;D:/BigData/input/ratings.txt&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> lines2 = sc.textFile(<span class="string">&quot;D:/BigData/input/movies.txt&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> movieIds_ratings = lines1.map(line =&gt; (line.split(<span class="string">&quot;,&quot;</span>)(<span class="number">1</span>), line.split(<span class="string">&quot;,&quot;</span>)(<span class="number">2</span>).toDouble))</span><br><span class="line">    <span class="keyword">val</span> ratings = movieIds_ratings.reduceByKey(_ + _)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> movieIds = lines1.map(line =&gt; (line.split(<span class="string">&quot;,&quot;</span>)(<span class="number">1</span>), <span class="number">1</span>))</span><br><span class="line">    <span class="keyword">val</span> movie_num = movieIds.reduceByKey((v1, v2) =&gt; v1 + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> result1 = ratings.join(movie_num).map(x =&gt; (x._1, (x._2._1 / x._2._2).formatted(<span class="string">&quot;%.2f&quot;</span>).toDouble))</span><br><span class="line"></span><br><span class="line">    lines2.map(line =&gt; (line.split(<span class="string">&quot;\\&#123;&quot;</span>)(<span class="number">0</span>), line.split(<span class="string">&quot;\\&#123;&quot;</span>)(<span class="number">2</span>), line.split(<span class="string">&quot;\\&#123;&quot;</span>)(<span class="number">1</span>))).foreach(x =&gt; (parseYear(x._1, x._2, x._3)))</span><br><span class="line">    sc.parallelize(ls_year).join(result1).map(x =&gt; (x._2._1._2, x._2._1._1, x._2._2)).foreach(x =&gt; parse(x._1, x._2, x._3))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> decade_genre_rating = sc.parallelize(ls_decadeGenreRating)</span><br><span class="line">      .map(x =&gt; (x._1, (x._2, <span class="number">1</span>)))</span><br><span class="line">      .reduceByKey((x, y) =&gt; (x._1 + y._1, x._2 + <span class="number">1</span>))</span><br><span class="line">      .map(x =&gt; (x._1, (x._2._1 / x._2._2).formatted(<span class="string">&quot;%.2f&quot;</span>)))</span><br><span class="line">      .map(x =&gt; (x._1._1, (x._1._2, x._2)))</span><br><span class="line">      .reduceByKey((x, y) =&gt; (x._1 + <span class="string">&quot; &quot;</span> + x._2 + <span class="string">&quot;|&quot;</span>, y._1 + <span class="string">&quot; &quot;</span> + y._2))</span><br><span class="line">    decade_genre_rating.collect.foreach(println)</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> ls_decadeGenreRating = <span class="type">List</span>(((<span class="string">&quot;Messi&quot;</span>, <span class="string">&quot;Barca&quot;</span>), <span class="number">1.0</span>))</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">parse</span></span>(str:<span class="type">String</span>, genres:<span class="type">String</span>, rating:<span class="type">Double</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (a &lt;- genres.split(<span class="string">&quot;\\|&quot;</span>)) &#123;</span><br><span class="line">      <span class="keyword">val</span> t = <span class="type">Tuple2</span>((str, a), rating)</span><br><span class="line">      ls_decadeGenreRating = t :: ls_decadeGenreRating</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> ls_year = <span class="type">List</span>((<span class="string">&quot;Messi&quot;</span>, (<span class="string">&quot;Barca&quot;</span>, <span class="string">&quot;Barca&quot;</span>)))</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">parseYear</span></span>(str1:<span class="type">String</span>, str2:<span class="type">String</span>, str3:<span class="type">String</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">if</span> (str3.split(<span class="string">&quot;`&quot;</span>).length == <span class="number">2</span>) &#123;</span><br><span class="line">      <span class="keyword">val</span> decade = (<span class="type">Integer</span>.parseInt(str3.split(<span class="string">&quot;`&quot;</span>)(<span class="number">1</span>).substring(<span class="number">0</span>, <span class="number">4</span>)) - <span class="number">1890</span>) / <span class="number">20</span></span><br><span class="line">      <span class="keyword">val</span> t = <span class="type">Tuple2</span>(str1, (str2, decade.toString))</span><br><span class="line">      ls_year = t :: ls_year</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="各流派内电影得分榜top10"><a href="#各流派内电影得分榜top10" class="headerlink" title="各流派内电影得分榜top10"></a>各流派内电影得分榜top10</h3><p>用户每天都在对“看过”的电影进行“很差”到“力荐”的评价，数据源中包含20000263条用户评价，其中最高为5星。我们根据每部影片看过的人对该影片所得的评价，通过hive分析出各个种类电影 Top 10，如果你想看某种类型的电影，可以在我们的排行榜中挑选出我们精选的高分电影！</p>
<h4 id="分析思路-1"><a href="#分析思路-1" class="headerlink" title="分析思路"></a><strong>分析思路</strong></h4><ol>
<li><p>数据采集</p>
<p>此次分析要用到数据源中的两个表movies和ratings。两个首先将预先处理过的数据采集到hdfs的/data/input/rating 和/data/input/movies中，接着创建相应的数据表ratings和movies，并将目标文件的数据导入数据库表。</p>
</li>
<li><p>数据处理</p>
<p>在ratings表中根据电影id分组，算出每个电影用户对它的评分的均分，作为此部电影的评分，并将结果保留进avg_rating表</p>
<p>在movies表中通过 find_in_set 筛选出指定流派的所有电影，并将查询结果和avg_rating表根据电影id为key进行内联接，联接后的数据为该流派所有电影和对应的分数，接着用order by desc排序，并限制显示前十条，即该流派高分电影top 10。</p>
</li>
</ol>
<h4 id="Hive代码"><a href="#Hive代码" class="headerlink" title="Hive代码"></a>Hive代码</h4><ol>
<li><p>建表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span>  ratings</span><br><span class="line">( userId <span class="type">int</span>,</span><br><span class="line">  movieId <span class="type">int</span>,</span><br><span class="line">  rating <span class="keyword">double</span>, </span><br><span class="line">  <span class="type">time</span> <span class="type">timestamp</span></span><br><span class="line"> ) </span><br><span class="line"> <span class="type">ROW</span> FORMAT </span><br><span class="line">  DELIMITED FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;,&#x27;</span> </span><br><span class="line">  lines Terminated <span class="keyword">by</span> &quot;\n&quot;</span><br><span class="line">  STORED <span class="keyword">AS</span> TEXTFILE</span><br><span class="line">  location &quot;/data/input/rating/&quot;;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span>  movies</span><br><span class="line">( movieId <span class="type">int</span>,</span><br><span class="line">  title string, </span><br><span class="line">  genres string</span><br><span class="line"> ) </span><br><span class="line"></span><br><span class="line"> comment &quot;Change in the number of movies&quot; </span><br><span class="line"> <span class="type">ROW</span> FORMAT </span><br><span class="line">  DELIMITED FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;&#123;&#x27;</span> </span><br><span class="line">  lines Terminated <span class="keyword">by</span> &quot;\n&quot;</span><br><span class="line">  STORED <span class="keyword">AS</span> TEXTFILE</span><br><span class="line">  location &quot;/data/input/movie/&quot;;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>根据用户评分表算出每部电影评分的均分，结果保留进均分表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> avg_rating</span><br><span class="line"><span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> movieid,<span class="built_in">avg</span>(rating) <span class="keyword">from</span> ratings <span class="keyword">group</span> <span class="keyword">by</span> movieid;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> avg_rating change _c1 avgrating <span class="type">decimal</span>(<span class="number">4</span>,<span class="number">3</span>)</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span><span class="keyword">alter</span> <span class="keyword">table</span> avg_rating change <span class="keyword">column</span> avgrating <span class="keyword">at</span> <span class="type">decimal</span>(<span class="number">4</span>,<span class="number">3</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>在movies表中筛选出指定类型所有电影，将此查询结果与均分表进行内连接，并且对连接后的结果根据分数排序，筛选前十，得出各个流派电影评分top10（下面以Adventure为例）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a.avgrating, m.title</span><br><span class="line"><span class="keyword">from</span> avg_rating a</span><br><span class="line"><span class="keyword">join</span> (<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> movies <span class="keyword">where</span> find_in_set(<span class="string">&#x27;Adventure&#x27;</span>, genres)<span class="operator">!=</span><span class="number">0</span>)m </span><br><span class="line"><span class="keyword">on</span>(a.movieid <span class="operator">=</span> m.movieid) </span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> avgrating <span class="keyword">desc</span> limit <span class="number">10</span>;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="图表"><a href="#图表" class="headerlink" title="图表"></a>图表</h4><p>以下节选部分类型排行榜top10</p>
<ol>
<li><p><strong>冒险片Adventure</strong> <strong>排行榜</strong></p>
<p> <img src="https://ws4.sinaimg.cn/large/006tNc79gy1fzhw0t2momj30ld09vgm3.jpg" alt=""></p>
</li>
<li><p><strong>喜剧片Comedy排行榜</strong></p>
<p> <img src="https://ws1.sinaimg.cn/large/006tNc79gy1fzhw14dnkmj30kd0a2gm2.jpg" alt=""></p>
</li>
<li><p><strong>爱情片Romance排行榜</strong></p>
<p> <img src="https://ws4.sinaimg.cn/large/006tNc79gy1fzhw1wzhguj30l60a074q.jpg" alt=""></p>
</li>
<li><p><strong>恐怖片**</strong>Thriller<strong>**排行榜</strong></p>
<p> <img src="https://ws3.sinaimg.cn/large/006tNc79gy1fzhw25koq7j30ma0a0wf2.jpg" alt=""></p>
</li>
</ol>
<h2 id="关于标签"><a href="#关于标签" class="headerlink" title="关于标签"></a>关于标签</h2><h3 id="高分电影中的比较多的标签"><a href="#高分电影中的比较多的标签" class="headerlink" title="高分电影中的比较多的标签"></a>高分电影中的比较多的标签</h3><p>电影的标签可以帮助我们更简单快捷的了解电影，每个电影都有丰富多彩的标签。在数据源中包含465564个标签，标签的相关性体现了它与电影的相关程度。我们想通过分析高分电影中哪些标签比较多，来研究高分电影与标签的联系。</p>
<h4 id="分析思路-2"><a href="#分析思路-2" class="headerlink" title="分析思路"></a>分析思路</h4><ol>
<li><p>数据采集</p>
<p>此次分析要用到数据源中的三个表genome-tas、genome-scores和tags。两个首先将预先处理过的数据采集到hdfs的/data/input/genome-tags 、/data/input/genome-scores和 /data/input/tags中，接着创建相应的数据表genome_tags、genome_scores和tags，并将目标文件的数据导入数据库表。</p>
</li>
<li><p>数据处理</p>
<ol>
<li><p>由于体现了标签和电影关联性的表中并没有标签id所对应的tag，所以首先将genome_scores表和genome_tags表通过tagid联接成一张表tags_relevance，genome_scores中每个tagid就有其相对应的tag。</p>
</li>
<li><p>因为每部电影相关联的标签很多，但并不是所有标签都是与内容关联性很紧密，所以数据处理的主要思路是根据关联程度筛选出每部电影最相关的三个标签。将tag_relevance表按电影名分组，并且在组内按标签关联度大小排序，最终每组取关联度最高的三个标签，得到每个电影关联性最大的三个标签，将此查询结果更新为新的tag_relevance表，其中每个电影只和关联度最大的三个标签对应。</p>
</li>
<li>将tag_relevance表和电影均分表avg_rating 通过电影id进行连接，并在联接结果中选出电影得分大于4分的所有电影，再按tagid和tag分组，求出每组tag的数量，按标签数从大到小的顺序排列，取前十。</li>
</ol>
</li>
</ol>
<h4 id="hive-代码"><a href="#hive-代码" class="headerlink" title="hive 代码"></a>hive 代码</h4><ol>
<li><p>建表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> genome_tags</span><br><span class="line">( tagId <span class="type">int</span>,</span><br><span class="line">  tag string</span><br><span class="line"> ) </span><br><span class="line"> <span class="type">ROW</span> FORMAT </span><br><span class="line">  DELIMITED FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;,&#x27;</span> </span><br><span class="line">  lines Terminated <span class="keyword">by</span> &quot;\n&quot;</span><br><span class="line">  STORED <span class="keyword">AS</span> TEXTFILE</span><br><span class="line">  location &quot;/data/input/genome-tags/&quot;;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span>  tags</span><br><span class="line">( userId <span class="type">int</span>,</span><br><span class="line">  movieId <span class="type">int</span>,</span><br><span class="line">  tag string,</span><br><span class="line">  <span class="type">time</span> <span class="type">timestamp</span></span><br><span class="line"> ) </span><br><span class="line"></span><br><span class="line"> <span class="type">ROW</span> FORMAT </span><br><span class="line">  DELIMITED FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;&#123;&#x27;</span> </span><br><span class="line">  lines Terminated <span class="keyword">by</span> &quot;\n&quot;</span><br><span class="line">  STORED <span class="keyword">AS</span> TEXTFILE</span><br><span class="line">  location &quot;/data/input/tags/&quot;;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span>  genome_scores</span><br><span class="line">( movieid <span class="type">int</span>,</span><br><span class="line">  tagid <span class="type">int</span>,</span><br><span class="line">  relevance <span class="keyword">double</span></span><br><span class="line"> ) </span><br><span class="line"></span><br><span class="line"> <span class="type">ROW</span> FORMAT </span><br><span class="line">  DELIMITED FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;,&#x27;</span> </span><br><span class="line">  lines Terminated <span class="keyword">by</span> &quot;\n&quot;</span><br><span class="line">  STORED <span class="keyword">AS</span> TEXTFILE</span><br><span class="line">  location &quot;/data/input/genome-scores/&quot;;</span><br></pre></td></tr></table></figure></li>
<li><p>关联genome_scores和genome_tags为一张表tags_relevance，为了让genome_scores中每个tagid对应相应tag</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tags_relevance</span><br><span class="line"><span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> a.<span class="operator">*</span>,b.tag</span><br><span class="line"><span class="keyword">from</span> genome_scores a</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> genome_tags b           </span><br><span class="line"><span class="keyword">on</span>(a.tagid <span class="operator">=</span> b.tagid);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>将tag_relevance表按电影名分组，并且在组内按标签关联度大小排序，最终每组取关联度最高的三个标签，得到每个电影关联性最大的三个标签</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">table</span> tags_relevance</span><br><span class="line"><span class="keyword">select</span> movieid,tagid,relevance,tag <span class="keyword">from</span>(</span><br><span class="line"> <span class="keyword">select</span> <span class="operator">*</span> ,<span class="built_in">row_number</span>() <span class="keyword">over</span> </span><br><span class="line"> (<span class="keyword">partition</span> <span class="keyword">by</span> movieid <span class="keyword">order</span> <span class="keyword">by</span> relevance <span class="keyword">desc</span>)<span class="keyword">as</span> row_num <span class="keyword">from</span> tags_relevance)<span class="keyword">as</span> tags_relevance</span><br><span class="line"> <span class="keyword">where</span> row_num <span class="operator">&lt;=</span><span class="number">3</span>;</span><br></pre></td></tr></table></figure></li>
<li><p>将3处理后的tag_relevance表和电影均分表avg_rating 连接，筛选出电影分数大于4分的，再按tagid和tag分组，求出每组数量，按标签数量从大到小排名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> c.tagid,c.tag,<span class="built_in">count</span>(c.tag) <span class="keyword">as</span> tag_num <span class="keyword">from</span></span><br><span class="line">(<span class="keyword">select</span> a.movieid,a.tagid,a.tag,b.avgrating <span class="keyword">from</span> </span><br><span class="line">  tags_relevance a <span class="keyword">join</span> avg_rating b</span><br><span class="line">  <span class="keyword">on</span>(a.movieid <span class="operator">=</span> b.movieid) </span><br><span class="line">  <span class="keyword">where</span> b.avgrating <span class="operator">&gt;</span> <span class="number">4</span>)c</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> c.tagid,c.tag <span class="keyword">order</span> <span class="keyword">by</span> tag_num <span class="keyword">desc</span> limit <span class="number">10</span>;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="图表-1"><a href="#图表-1" class="headerlink" title="图表"></a>图表</h4><p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fzhw3izia8j30cy06wwee.jpg" alt=""></p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fzhw4g1ynkj30oy0e8aa8.jpg" alt=""></p>
<h4 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h4><p>根据图表可知，高分电影中标签数量最多的是imdb top 250，说明imdb的电影排行榜还是很靠谱的，其排行榜上的电影也是movielens网站中用户给高分最多的；排名第二的为hitchcock，这是一个知名的导演的名字，他的代表作为<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%90%8E%E7%AA%97">后窗</a>、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%83%8A%E9%AD%82%E8%AE%B0">惊魂记</a>、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E8%A5%BF%E5%8C%97%E5%81%8F%E5%8C%97">西北偏北</a>、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E8%9D%B4%E8%9D%B6%E6%A2%A6">蝴蝶梦</a>、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%88%97%E8%BD%A6%E4%B8%8A%E7%9A%84%E9%99%8C%E7%94%9F%E4%BA%BA">列车上的陌生人</a>等，曾获得过奥斯卡奖终身成就奖，高分电影中以这位导演为标签的数目比较多，说明这位大众对这位导演的电影都有很高的评价；排名第三的为criterion标准，说明大众给标准化的电影打分也是可观的；排名第四的为oscar（best picture）奥斯卡最佳影片，说明奥斯卡评出来的电影是很权威的，也是符合大众口味的；第五名为Screwball comedy疯狂喜剧，之后又接着两个与奥斯卡相关的，看来奥斯卡评出的电影确实是很不错的电影，不论是对专家还是对看电影的用户来说。</p>
<h3 id="电影得分与标签数量之间的关系"><a href="#电影得分与标签数量之间的关系" class="headerlink" title="电影得分与标签数量之间的关系"></a>电影得分与标签数量之间的关系</h3><p>根据ratings.csv文件提取userId列、movieId列、rating列、stamp列和根据tags.csv文件提取userId列、movieId列、tag列、stamp列进行数据处理，从而进行分析每部电影标签总数与其得分之间的关系；</p>
<h4 id="数据处理-1"><a href="#数据处理-1" class="headerlink" title="数据处理"></a>数据处理</h4><ol>
<li><p>将预先处理过的文本文件上传到hdfs里面</p>
<p>新建文件夹</p>
<p><img src="http://oom3nz471.bkt.clouddn.com/15.jpg" alt="img"> </p>
<p>将虚拟机上的文件传到hdfs上面（以tags.txt文件为例）</p>
<p><img src="http://oom3nz471.bkt.clouddn.com/16.jpg" alt="img"> </p>
</li>
<li><p>创建相应的数据库表，上传相应数据</p>
<p>在虚拟机终端输入ifconfig命令，查看IP</p>
<p><img src="http://oom3nz471.bkt.clouddn.com/17.jpg" alt="img"> </p>
<p>在浏览器输入以下IP地址（加上：8888）</p>
<p><img src="http://oom3nz471.bkt.clouddn.com/18.jpg" alt="img"> </p>
</li>
</ol>
<h4 id="进入HUE界面，开始建表，主要部分代码如下"><a href="#进入HUE界面，开始建表，主要部分代码如下" class="headerlink" title="进入HUE界面，开始建表，主要部分代码如下"></a>进入HUE界面，开始建表，主要部分代码如下</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> tag(</span><br><span class="line">userId <span class="type">int</span>,</span><br><span class="line">movieId <span class="type">int</span>,</span><br><span class="line">tag string,</span><br><span class="line">stamp <span class="type">int</span>)<span class="operator">/</span><span class="operator">/</span>输入数据类型</span><br><span class="line"><span class="type">ROW</span> FORMAT DELIMITED FIELDS TERMINATED <span class="keyword">BY</span><span class="string">&#x27;,&#x27;</span></span><br><span class="line">LINES TERMINATED <span class="keyword">BY</span>&quot;\n&quot;</span><br><span class="line">stored <span class="keyword">as</span> textfile</span><br><span class="line">location &quot;/tag&quot;;<span class="operator">/</span><span class="operator">/</span>导入数据到数据库</span><br></pre></td></tr></table></figure>
<p>使用查询语句查询相应的信息: </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(tag),<span class="built_in">avg</span>(rating)<span class="keyword">from</span> tag <span class="keyword">join</span> rating <span class="keyword">where</span> rating.movieId <span class="operator">=</span> tag.movieId <span class="keyword">group</span> <span class="keyword">by</span> rating.movieId;   <span class="operator">/</span><span class="operator">/</span>求每个电影标签总数和平均得分</span><br></pre></td></tr></table></figure>
<h4 id="利用HUE工具对新建数据库中的数据进行结果的绘制"><a href="#利用HUE工具对新建数据库中的数据进行结果的绘制" class="headerlink" title="利用HUE工具对新建数据库中的数据进行结果的绘制"></a>利用HUE工具对新建数据库中的数据进行结果的绘制</h4><ol>
<li><p>电影编号-标签数量-电影平均分: </p>
<p><img src="http://oom3nz471.bkt.clouddn.com/19.jpg" alt="img"> </p>
</li>
<li><p>电影得分标签数量分布图</p>
<p><img src="http://oom3nz471.bkt.clouddn.com/20.jpg" alt="img"></p>
</li>
<li><p>图表4.2.2-3 电影得分与标签数量关系柱状图</p>
<p><img src="http://oom3nz471.bkt.clouddn.com/21.jpg" alt="img"> </p>
</li>
</ol>
<h4 id="结论-1"><a href="#结论-1" class="headerlink" title="结论"></a>结论</h4><p>由上面的图表可以看出标签数量较多的集中在大致在电影得分在3.5-4.0范围之间，而标签数量大致随电影得分的增高而增长，在4.0到5.0之间这个趋势有点减弱，这个分数阶段的标签数量相对与3.5-4.0之间要少许多；就此分析，我们可以推论得分3.5-4.0的电影可能更被人熟知，被更多的人评论，从而贴上更多的标签，剧情各方面的综合性比较强；而可能得分0-4.0的电影不怎么符合大众的口味，或者剧情各方面经不起推敲，接近烂片的标准；至于得分4.0-5.0的电影属于被人遗忘的佳作的类型，亦或是佳作根本无需贴标签，只需要静静欣赏的类型…</p>
<h2 id="关于年代"><a href="#关于年代" class="headerlink" title="关于年代"></a>关于年代</h2><h3 id="电影数量与年代变化之间的关系"><a href="#电影数量与年代变化之间的关系" class="headerlink" title="电影数量与年代变化之间的关系"></a>电影数量与年代变化之间的关系</h3><p>电影数量随着年份将有怎样的变化？我们将对从1890年开始的27278部电影进行分析，统计出从1890年开始每20年电影数量的变化。</p>
<h4 id="分析思路-3"><a href="#分析思路-3" class="headerlink" title="分析思路"></a>分析思路</h4><p>由于数据源中没有单独的电影年份字段，所以要在电影名中提取出电影年份，为了便于mapreduce中切割，首先对数据源的movies表进行预处理，单独提取出movies表的title（电影名），并将电影名字段中的年份前面用专门的符号替换</p>
<p>数据源处理完后，开始编写mapreduce程序，map处理文件的每一行，其逻辑为判断分割出来的年份属于哪个年份区间，并将年份区间作为key，value值为1，在reduce中将分组后的（key，value）中的value值进行累加，算出每个年份区间中电影的数目。</p>
<h4 id="MapReduce代码"><a href="#MapReduce代码" class="headerlink" title="MapReduce代码"></a>MapReduce代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> film_numchange_years;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FileSystem;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.IntWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.SequenceFileOutputFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NumChangeTwoDecades</span> </span>&#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">FMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>,<span class="title">Text</span>,<span class="title">Text</span>,<span class="title">IntWritable</span>&gt;</span>&#123;</span><br><span class="line">	   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key,Text value,Context context)</span> <span class="keyword">throws</span> IOException,InterruptedException</span>&#123;</span><br><span class="line">		String[] strs = value.toString().split(<span class="string">&quot;\&#123;&quot;</span>);</span><br><span class="line">		    <span class="keyword">if</span>(strs.length == <span class="number">2</span>)&#123;</span><br><span class="line">			<span class="keyword">int</span> year = Integer.parseInt(strs[<span class="number">1</span>].trim());</span><br><span class="line">            Text keyY = <span class="keyword">new</span> Text(<span class="string">&quot;&quot;</span>);</span><br><span class="line">			<span class="keyword">if</span> ( year&gt;=<span class="number">1891</span> &amp;&amp; year&lt;=<span class="number">1911</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				keyY.set(<span class="string">&quot;1891-1911&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (year&gt;=<span class="number">1912</span> &amp;&amp; year&lt;=<span class="number">1932</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				keyY.set(<span class="string">&quot;1912-1932&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (year&gt;=<span class="number">1933</span> &amp;&amp; year&lt;=<span class="number">1953</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				keyY.set(<span class="string">&quot;1933-1953&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (year&gt;=<span class="number">1954</span> &amp;&amp; year&lt;=<span class="number">1974</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				keyY.set(<span class="string">&quot;1954-1974&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> <span class="keyword">if</span> (year&gt;=<span class="number">1975</span> &amp;&amp; year&lt;=<span class="number">1995</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				keyY.set(<span class="string">&quot;1975-1995&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span> </span><br><span class="line">			&#123;</span><br><span class="line">				keyY.set(<span class="string">&quot;1996-2017&quot;</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			context.write(keyY,<span class="keyword">new</span> IntWritable(<span class="number">1</span>));</span><br><span class="line">		 &#125;</span><br><span class="line">	   &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">FReducer</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>,<span class="title">IntWritable</span>,<span class="title">Text</span>,<span class="title">IntWritable</span>&gt;</span>&#123;</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key,Iterable&lt;IntWritable&gt; value,Context context)</span> <span class="keyword">throws</span> IOException,InterruptedException</span>&#123;</span><br><span class="line">		    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span>(IntWritable num:value)&#123;</span><br><span class="line">				sum=sum+num.get();</span><br><span class="line">			&#125;</span><br><span class="line">			context.write(key, <span class="keyword">new</span> IntWritable(sum));</span><br><span class="line">	  &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span>  <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(args.length&lt;<span class="number">2</span>)&#123;</span><br><span class="line">			System.out.println(<span class="string">&quot;Usage:&lt;inputPath&gt;&lt;outputPath&gt;&quot;</span>);</span><br><span class="line">			System.exit(<span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		Path inputPath = <span class="keyword">new</span> Path(args[<span class="number">0</span>]);</span><br><span class="line">		Path OutputPath = <span class="keyword">new</span> Path(args[<span class="number">1</span>]);</span><br><span class="line">		Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">		FileSystem fs = FileSystem.get(conf);</span><br><span class="line">		<span class="keyword">if</span>(fs.exists(OutputPath))&#123;</span><br><span class="line">			fs.delete(OutputPath,<span class="keyword">true</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		Job job = Job.getInstance(conf);</span><br><span class="line">		job.setJobName(<span class="string">&quot;NumChangeTwoDecades&quot;</span>);</span><br><span class="line">		job.setJarByClass(NumChangeTwoDecades.class);</span><br><span class="line">		FileInputFormat.setInputPaths(job, inputPath);</span><br><span class="line">		FileOutputFormat.setOutputPath(job, OutputPath);</span><br><span class="line">		job.setMapperClass(FMapper.class);</span><br><span class="line">		job.setReducerClass(FReducer.class);</span><br><span class="line">		<span class="comment">//job.setCombinerClass(WReducer.class);</span></span><br><span class="line">		job.setOutputFormatClass(SequenceFileOutputFormat.class);</span><br><span class="line">		job.setMapOutputKeyClass(Text.class);</span><br><span class="line">		job.setMapOutputValueClass(IntWritable.class);</span><br><span class="line">		job.setOutputKeyClass(Text.class);</span><br><span class="line">		job.setOutputValueClass(IntWritable.class);</span><br><span class="line">		job.waitForCompletion(<span class="keyword">true</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="图表与结论"><a href="#图表与结论" class="headerlink" title="图表与结论"></a>图表与结论</h4><p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fzhvz8s4rtj30a1061t8j.jpg" alt=""></p>
<p>从时间来看，如图所示，从1891年开始到2017年，上映的电影数量整体趋势上涨。在18世纪末，电影行业应该才刚刚起步，电影数量非常少，而到了十九世纪，电影逐渐增加，特别是到了19世纪末，电影数量开始飞速增长，到了20世纪，十几年内电影数量已经达到了14000万以上。</p>
<h3 id="各流派电影数量随年代的变化趋势"><a href="#各流派电影数量随年代的变化趋势" class="headerlink" title="各流派电影数量随年代的变化趋势"></a>各流派电影数量随年代的变化趋势</h3><h4 id="分析思路-4"><a href="#分析思路-4" class="headerlink" title="分析思路"></a>分析思路</h4><p>作为电影导演和制片人需要了解当今电影市场的需求，为了能够准确判断市场方向，需要了解哪种类型的电影市场需求大，更受观众喜爱，并且需要预测市场今后的走向。所以我们分析了电影产业起始以来，不同类型的电影随时间的变化趋势。</p>
<h4 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h4><ol>
<li><p>首先需要对数据源做预处理操作，去除干扰字符，替换切分字符，易于切分操作。</p>
</li>
<li><p>然后对movie表进行操作，提取其中title列和genres列。由于每一个电影有多个genres所以将genres切割并且每一个都作为key值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String[] strs = value.toString().split(<span class="string">&quot;\&#123;&quot;</span>);<span class="comment">//切分行数据</span></span><br><span class="line">String Type=strs[<span class="number">2</span>];</span><br><span class="line">String[] Types=Type.split(<span class="string">&quot;\|&quot;</span>);<span class="comment">//切分不同类型</span></span><br><span class="line">keyWord = <span class="keyword">new</span> Text(Types[i]);<span class="comment">//作为key值</span></span><br></pre></td></tr></table></figure></li>
<li><p>再对title中的年份进行提取：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String keyValue1=strs[<span class="number">1</span>];</span><br><span class="line">String[] title=keyValue1.toString().split(<span class="string">&quot;\`&quot;</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>由于有的title列被多切分出了几个数，导致程序无法正常运行，此时需要加入判断语句，去除问题数据行。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (title.length==<span class="number">2</span>)&#123;</span><br><span class="line">	String keyValue2=title[<span class="number">1</span>].substring(<span class="number">0</span>, <span class="number">4</span>);<span class="comment">//提取出四个数字，即年份</span></span><br><span class="line">     ……</span><br><span class="line">	keyValue=<span class="keyword">new</span> Text(keyValue2);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;Types.length;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		……</span><br><span class="line">	context.write(keyWord,keyValue);<span class="comment">//类型作为key，年份作为value输出</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>reduce中计算每个类型不同年份的数量</li>
</ol>
<p><strong>完整代码如下：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> movie;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FileSystem;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.SequenceFileOutputFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OneMivieTrend</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TrendMap</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>,<span class="title">Text</span>,<span class="title">Text</span>,<span class="title">Text</span>&gt;</span>&#123;</span><br><span class="line">		Text keyWord;</span><br><span class="line">		Text keyValue;</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key,Text value,Context context)</span><span class="keyword">throws</span> IOException,InterruptedException</span>&#123;</span><br><span class="line">			String[] strs = value.toString().split(<span class="string">&quot;\\&#123;&quot;</span>);		   </span><br><span class="line">			String Type=strs[<span class="number">2</span>];</span><br><span class="line">			String[] Types=Type.split(<span class="string">&quot;\\|&quot;</span>);</span><br><span class="line">			String keyValue1=strs[<span class="number">1</span>];</span><br><span class="line">			String[] title=keyValue1.toString().split(<span class="string">&quot;\\`&quot;</span>);</span><br><span class="line">			<span class="keyword">if</span> (title.length==<span class="number">2</span>)&#123;</span><br><span class="line">				String keyValue2=title[<span class="number">1</span>].substring(<span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">			keyValue=<span class="keyword">new</span> Text(keyValue2);</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;Types.length;i++)</span><br><span class="line">			&#123;</span><br><span class="line">				keyWord = <span class="keyword">new</span> Text(Types[i]);</span><br><span class="line">				context.write(keyWord,keyValue);</span><br><span class="line">			&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;	</span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TrendReduce</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>,<span class="title">Text</span>,<span class="title">Text</span>,<span class="title">Text</span>&gt;</span>&#123;</span><br><span class="line">  	  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key,Iterable&lt;Text&gt; values,Context context)</span> </span></span><br><span class="line"><span class="function">  			  <span class="keyword">throws</span> IOException,InterruptedException</span>&#123;</span><br><span class="line">  		    String strfirst=<span class="string">&quot;&quot;</span>;</span><br><span class="line">			String strsec=<span class="string">&quot;&quot;</span>;</span><br><span class="line">			String strth=<span class="string">&quot;&quot;</span>;</span><br><span class="line">			String strfour=<span class="string">&quot;&quot;</span>;</span><br><span class="line">			String strfif=<span class="string">&quot;&quot;</span>;</span><br><span class="line">			String strsix=<span class="string">&quot;&quot;</span>;</span><br><span class="line">			<span class="keyword">int</span> first=<span class="number">0</span>;</span><br><span class="line">			  <span class="keyword">int</span> second=<span class="number">0</span>;</span><br><span class="line">			  <span class="keyword">int</span> third=<span class="number">0</span>;</span><br><span class="line">			  <span class="keyword">int</span> fourth=<span class="number">0</span>;</span><br><span class="line">			  <span class="keyword">int</span> fifth=<span class="number">0</span>;</span><br><span class="line">			  <span class="keyword">int</span> sixth=<span class="number">0</span>;</span><br><span class="line">  		  <span class="keyword">for</span>(Text val:values)&#123;</span><br><span class="line">  			  String vall=val.toString();</span><br><span class="line">  			  <span class="keyword">int</span> year=Integer.parseInt(vall);</span><br><span class="line">  			  <span class="keyword">if</span>(year&gt;<span class="number">1896</span>&amp;&amp;year&lt;<span class="number">1916</span>)</span><br><span class="line">  			  &#123;</span><br><span class="line">  				  first=first+<span class="number">1</span>;</span><br><span class="line">  			  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(year&gt;=<span class="number">1916</span>&amp;&amp;year&lt;<span class="number">1936</span>)</span><br><span class="line">			  &#123;</span><br><span class="line">			      second=second+<span class="number">1</span>;</span><br><span class="line">			  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(year&gt;=<span class="number">1936</span>&amp;&amp;year&lt;<span class="number">1956</span>)</span><br><span class="line">			  &#123;</span><br><span class="line">				  third=third+<span class="number">1</span>;</span><br><span class="line">			  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(year&gt;=<span class="number">1956</span>&amp;&amp;year&lt;<span class="number">1976</span>)</span><br><span class="line">			  &#123;</span><br><span class="line">				  fourth=fourth+<span class="number">1</span>;</span><br><span class="line">			  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(year&gt;=<span class="number">1979</span>&amp;&amp;year&lt;<span class="number">1996</span>)</span><br><span class="line">			  &#123;</span><br><span class="line">				  fifth=fifth+<span class="number">1</span>;</span><br><span class="line">			  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				  sixth=sixth+<span class="number">1</span>;</span><br><span class="line">			  &#125;</span><br><span class="line">  			strfirst=String.valueOf(first);</span><br><span class="line">  			strsec=String.valueOf(second);</span><br><span class="line">  			strth=String.valueOf(third);</span><br><span class="line">  		    strfour=String.valueOf(fourth);</span><br><span class="line">  			strfif=String.valueOf(fifth);</span><br><span class="line">  			strsix=String.valueOf(sixth);</span><br><span class="line">  		  &#125;</span><br><span class="line">  		</span><br><span class="line">  		  <span class="comment">//sb.deleteCharAt(sb.length() - 1);</span></span><br><span class="line">  		  <span class="comment">//Text value = new Text(sb.toString());</span></span><br><span class="line">  		  context.write(key,<span class="keyword">new</span> Text(<span class="string">&quot;\n&quot;</span>+<span class="string">&quot;1896-1916&quot;</span> +<span class="string">&quot;:&quot;</span>+strfirst+<span class="string">&quot;\n&quot;</span>+<span class="string">&quot;1916-1936&quot;</span>+<span class="string">&quot;:&quot;</span>+strsec+<span class="string">&quot;\n&quot;</span>+<span class="string">&quot;1936-1956&quot;</span>+<span class="string">&quot;:&quot;</span>+strth+<span class="string">&quot;\n&quot;</span>+<span class="string">&quot;1956-1976&quot;</span>+<span class="string">&quot;:&quot;</span>+strfour+<span class="string">&quot;\n&quot;</span>+<span class="string">&quot;1976-1996&quot;</span>+<span class="string">&quot;:&quot;</span>+strfif+<span class="string">&quot;\n&quot;</span>+<span class="string">&quot;1996-&quot;</span>+<span class="string">&quot;:&quot;</span>+strsix+<span class="string">&quot;\n&quot;</span>));</span><br><span class="line">  	  &#125;</span><br><span class="line">  	 </span><br><span class="line">    &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span>  <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(args.length&lt;<span class="number">2</span>)&#123;</span><br><span class="line">			System.out.println(<span class="string">&quot;Usage:&lt;inputPath&gt;&lt;outputPath&gt;&quot;</span>);</span><br><span class="line">			System.exit(<span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		Path inputPath = <span class="keyword">new</span> Path(args[<span class="number">0</span>]);</span><br><span class="line">		Path OutputPath = <span class="keyword">new</span> Path(args[<span class="number">1</span>]);</span><br><span class="line">		Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">		FileSystem fs = FileSystem.get(conf);</span><br><span class="line">		<span class="keyword">if</span>(fs.exists(OutputPath))&#123;</span><br><span class="line">			fs.delete(OutputPath,<span class="keyword">true</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		Job job = Job.getInstance(conf);</span><br><span class="line">		job.setJobName(<span class="string">&quot;movie&quot;</span>);</span><br><span class="line">		job.setJarByClass(OneMivieTrend.class);</span><br><span class="line">		</span><br><span class="line">		FileInputFormat.setInputPaths(job, inputPath);</span><br><span class="line">		FileOutputFormat.setOutputPath(job, OutputPath);</span><br><span class="line">		job.setMapperClass(TrendMap.class);</span><br><span class="line">		job.setReducerClass(TrendReduce.class);</span><br><span class="line">		<span class="comment">//job.setCombinerClass(WReducer.class);</span></span><br><span class="line">		job.setOutputFormatClass(SequenceFileOutputFormat.class);</span><br><span class="line">		job.setMapOutputKeyClass(Text.class);</span><br><span class="line">		job.setMapOutputValueClass(Text.class);</span><br><span class="line">		job.setOutputKeyClass(Text.class);</span><br><span class="line">		job.setOutputValueClass(Text.class);</span><br><span class="line">		job.waitForCompletion(<span class="keyword">true</span>);</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="图表-2"><a href="#图表-2" class="headerlink" title="图表"></a>图表</h4><p><img src="http://oom3nz471.bkt.clouddn.com/23.jpg" alt="img">  </p>
<p><img src="http://oom3nz471.bkt.clouddn.com/24.jpg" alt="img"> </p>
<h4 id="结论-2"><a href="#结论-2" class="headerlink" title="结论"></a>结论</h4><p>由图1可看出在电影史上drama类型的电影数量一直处于上升趋势，很多电影喜欢加入drama的因素在其中，也说明市场一直需要drama类型的电影。但是由图2知在2011年之后drama类型的电影出现了陡然下降的趋势，其原因可能是drama类型的电影的关注开始降低，也可能是由于整体电影市场中电影数量的减少导致。</p>
<p>虽然在整个电影史上电影的总数量呈极速增长的趋势，但是在2011年之后几乎所有类型的电影的数量都开始减少。经分析，其原因可能是：1、电影的类型开始不多元化（如果一个电影有多个类型标签，则通过此统计算出的此类型的电影数量会变多）2、电影拍摄数量确实开始减少，可能是因为电影拍摄成本升高的原因3、电影市场需求量减少。总而言之，电影圈的竞争越来越激烈。</p>
<p>从图2我们还可以看出只有IMAX类型的电影处于增长趋势，这说明今后此技术的电影需求量在上升。</p>
<h3 id="不同年代的电影数量最多的流派"><a href="#不同年代的电影数量最多的流派" class="headerlink" title="不同年代的电影数量最多的流派"></a>不同年代的电影数量最多的流派</h3><h4 id="分析思路-5"><a href="#分析思路-5" class="headerlink" title="分析思路"></a>分析思路</h4><p>不同年代电影观众的口味可能会不同，所以我们研究了不同年代哪些电影数量最多的电影类型。通过研究这个，可以判断每个年代的社会风气、群众关注焦点以及观众品味，有利于对电影史的研究以及对人类社会的研究。</p>
<h4 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h4><p>使用mapreduce</p>
<p>其中map类容与上述一致</p>
<p> Reduce：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(year&gt;<span class="number">1960</span>&amp;&amp;year&lt;<span class="number">1970</span>)</span><br><span class="line">&#123;</span><br><span class="line">	first=first+<span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>(year&gt;=<span class="number">1970</span>&amp;&amp;year&lt;<span class="number">1980</span>)</span><br><span class="line">&#123;</span><br><span class="line">	second=second+<span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>(year&gt;=<span class="number">1980</span>&amp;&amp;year&lt;<span class="number">1990</span>)</span><br><span class="line">&#123;</span><br><span class="line">	third=third+<span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>(year&gt;=<span class="number">1990</span>&amp;&amp;year&lt;<span class="number">2000</span>)</span><br><span class="line">&#123;</span><br><span class="line">	fourth=fourth+<span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>(year&gt;=<span class="number">2000</span>&amp;&amp;year&lt;<span class="number">2010</span>)</span><br><span class="line">&#123;</span><br><span class="line">	fifth=fifth+<span class="number">1</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>(year&gt;=<span class="number">2010</span>)&#123;</span><br><span class="line">	sixth=sixth+<span class="number">1</span>;</span><br><span class="line">&#125;<span class="comment">// 对不同年代电影数量进行统计</span></span><br></pre></td></tr></table></figure>
<p><strong>完整代码如下</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> movie;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FileSystem;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.SequenceFileOutputFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MovieMountCompare</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TrendMap</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>,<span class="title">Text</span>,<span class="title">Text</span>,<span class="title">Text</span>&gt;</span>&#123;</span><br><span class="line">		Text keyWord;</span><br><span class="line">		Text keyValue;</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key,Text value,Context context)</span><span class="keyword">throws</span> IOException,InterruptedException</span>&#123;</span><br><span class="line">			String[] strs = value.toString().split(<span class="string">&quot;\\&#123;&quot;</span>);</span><br><span class="line">			String Type=strs[<span class="number">2</span>];</span><br><span class="line">			String[] Types=Type.split(<span class="string">&quot;\\|&quot;</span>);</span><br><span class="line">			String keyValue1=strs[<span class="number">1</span>];</span><br><span class="line">			String[] title=keyValue1.toString().split(<span class="string">&quot;\\`&quot;</span>);</span><br><span class="line">			<span class="keyword">if</span> (title.length==<span class="number">2</span>)&#123;</span><br><span class="line">				String keyValue2=title[<span class="number">1</span>].substring(<span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">			keyValue=<span class="keyword">new</span> Text(keyValue2);</span><br><span class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;Types.length;i++)</span><br><span class="line">			&#123;</span><br><span class="line">				keyWord = <span class="keyword">new</span> Text(Types[i]);</span><br><span class="line">				context.write(keyWord,keyValue);</span><br><span class="line">			&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;	</span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TrendReduce</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>,<span class="title">Text</span>,<span class="title">Text</span>,<span class="title">Text</span>&gt;</span>&#123;</span><br><span class="line">  	  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key,Iterable&lt;Text&gt; values,Context context)</span> </span></span><br><span class="line"><span class="function">  			  <span class="keyword">throws</span> IOException,InterruptedException</span>&#123;</span><br><span class="line">  		    String strfirst=<span class="string">&quot;&quot;</span>;</span><br><span class="line">			String strsec=<span class="string">&quot;&quot;</span>;</span><br><span class="line">			String strth=<span class="string">&quot;&quot;</span>;</span><br><span class="line">			String strfour=<span class="string">&quot;&quot;</span>;</span><br><span class="line">			String strfif=<span class="string">&quot;&quot;</span>;</span><br><span class="line">			String strsix=<span class="string">&quot;&quot;</span>;</span><br><span class="line">			<span class="keyword">int</span> first=<span class="number">0</span>;</span><br><span class="line">			  <span class="keyword">int</span> second=<span class="number">0</span>;</span><br><span class="line">			  <span class="keyword">int</span> third=<span class="number">0</span>;</span><br><span class="line">			  <span class="keyword">int</span> fourth=<span class="number">0</span>;</span><br><span class="line">			  <span class="keyword">int</span> fifth=<span class="number">0</span>;</span><br><span class="line">			  <span class="keyword">int</span> sixth=<span class="number">0</span>;</span><br><span class="line">		  <span class="keyword">for</span>(Text val:values)&#123;</span><br><span class="line">			  String vall=val.toString();</span><br><span class="line">			  <span class="keyword">int</span> year=Integer.parseInt(vall);</span><br><span class="line">			  <span class="keyword">if</span>(year&gt;<span class="number">1960</span>&amp;&amp;year&lt;<span class="number">1970</span>)</span><br><span class="line">			  &#123;</span><br><span class="line">				  first=first+<span class="number">1</span>;</span><br><span class="line">			  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(year&gt;=<span class="number">1970</span>&amp;&amp;year&lt;<span class="number">1980</span>)</span><br><span class="line">			  &#123;</span><br><span class="line">			      second=second+<span class="number">1</span>;</span><br><span class="line">			  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(year&gt;=<span class="number">1980</span>&amp;&amp;year&lt;<span class="number">1990</span>)</span><br><span class="line">			  &#123;</span><br><span class="line">				  third=third+<span class="number">1</span>;</span><br><span class="line">			  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(year&gt;=<span class="number">1990</span>&amp;&amp;year&lt;<span class="number">2000</span>)</span><br><span class="line">			  &#123;</span><br><span class="line">				  fourth=fourth+<span class="number">1</span>;</span><br><span class="line">			  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(year&gt;=<span class="number">2000</span>&amp;&amp;year&lt;<span class="number">2010</span>)</span><br><span class="line">			  &#123;</span><br><span class="line">				  fifth=fifth+<span class="number">1</span>;</span><br><span class="line">			  &#125;<span class="keyword">else</span> <span class="keyword">if</span>(year&gt;=<span class="number">2010</span>)&#123;</span><br><span class="line">				  sixth=sixth+<span class="number">1</span>;</span><br><span class="line">			  &#125;</span><br><span class="line">			strfirst=String.valueOf(first);</span><br><span class="line">			strsec=String.valueOf(second);</span><br><span class="line">			strth=String.valueOf(third);</span><br><span class="line">		    strfour=String.valueOf(fourth);</span><br><span class="line">			strfif=String.valueOf(fifth);</span><br><span class="line">			strsix=String.valueOf(sixth);</span><br><span class="line">		  &#125;</span><br><span class="line">  		  <span class="comment">//sb.deleteCharAt(sb.length() - 1);</span></span><br><span class="line">  		  <span class="comment">//Text value = new Text(sb.toString());</span></span><br><span class="line">  		  context.write(key,<span class="keyword">new</span> Text(<span class="string">&quot;\n&quot;</span>+<span class="string">&quot;1960-1970&quot;</span> +<span class="string">&quot;:&quot;</span>+strfirst+<span class="string">&quot;\n&quot;</span>+<span class="string">&quot;1970-1980&quot;</span>+strsec+<span class="string">&quot;\n&quot;</span>+<span class="string">&quot;1980-1990&quot;</span>+strth+<span class="string">&quot;\n&quot;</span>+<span class="string">&quot;1990-2000&quot;</span>+strfour+<span class="string">&quot;\n&quot;</span>+<span class="string">&quot;2000-2010&quot;</span>+strfif+<span class="string">&quot;\n&quot;</span>+<span class="string">&quot;2010-2017&quot;</span>+strsix+<span class="string">&quot;\n&quot;</span>));</span><br><span class="line">  	  &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span>  <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(args.length&lt;<span class="number">2</span>)&#123;</span><br><span class="line">			System.out.println(<span class="string">&quot;Usage:&lt;inputPath&gt;&lt;outputPath&gt;&quot;</span>);</span><br><span class="line">			System.exit(<span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		Path inputPath = <span class="keyword">new</span> Path(args[<span class="number">0</span>]);</span><br><span class="line">		Path OutputPath = <span class="keyword">new</span> Path(args[<span class="number">1</span>]);</span><br><span class="line">		Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">		FileSystem fs = FileSystem.get(conf);</span><br><span class="line">		<span class="keyword">if</span>(fs.exists(OutputPath))&#123;</span><br><span class="line">			fs.delete(OutputPath,<span class="keyword">true</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		Job job = Job.getInstance(conf);</span><br><span class="line">		job.setJobName(<span class="string">&quot;MovieMountCompare&quot;</span>);</span><br><span class="line">		job.setJarByClass(MovieMountCompare.class);</span><br><span class="line">		FileInputFormat.setInputPaths(job, inputPath);</span><br><span class="line">		FileOutputFormat.setOutputPath(job, OutputPath);</span><br><span class="line">		job.setMapperClass(TrendMap.class);</span><br><span class="line">		job.setReducerClass(TrendReduce.class);</span><br><span class="line">		<span class="comment">//job.setCombinerClass(WReducer.class);</span></span><br><span class="line">		job.setOutputFormatClass(SequenceFileOutputFormat.class);</span><br><span class="line">		job.setMapOutputKeyClass(Text.class);</span><br><span class="line">		job.setMapOutputValueClass(Text.class);</span><br><span class="line">		job.setOutputKeyClass(Text.class);</span><br><span class="line">		job.setOutputValueClass(Text.class);</span><br><span class="line">		job.waitForCompletion(<span class="keyword">true</span>);</span><br><span class="line">	&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="图表-3"><a href="#图表-3" class="headerlink" title="图表"></a>图表</h4><p><img src="http://oom3nz471.bkt.clouddn.com/25.jpg" alt="img"> </p>
<p><img src="http://oom3nz471.bkt.clouddn.com/26.jpg" alt="img"> </p>
<p><img src="http://oom3nz471.bkt.clouddn.com/27.jpg" alt="img"> </p>
<p><img src="http://oom3nz471.bkt.clouddn.com/28.jpg" alt="img"> </p>
<p><img src="http://oom3nz471.bkt.clouddn.com/29.jpg" alt="img"> </p>
<p><img src="http://oom3nz471.bkt.clouddn.com/30.jpg" alt="img"> </p>
<h4 id="结论-3"><a href="#结论-3" class="headerlink" title="结论"></a>结论</h4><p>60、70、80年代Drama、conmedy和action的电影类型数量最多，90年代之后thriller类型替换了action进入了前三。</p>
<p>戏剧与喜剧一直高居榜首可见这两个类型是大多数电影的主要元素，市场欢迎程度最高，这也说明了大多数人看电影主要是为了娱乐和放松，也揭示了电影最主要的功能是娱乐大众。</p>
<p>在90年代以后，恐怖片的数量超过动作片，可以说明恐怖片的市场在增长，可能是因为人们开始更多寻求心理上的刺激。</p>
<h3 id="上世纪与本世纪比较受欢迎的电影类别"><a href="#上世纪与本世纪比较受欢迎的电影类别" class="headerlink" title="上世纪与本世纪比较受欢迎的电影类别"></a>上世纪与本世纪比较受欢迎的电影类别</h3><h4 id="分析思路-6"><a href="#分析思路-6" class="headerlink" title="分析思路"></a>分析思路</h4><p>根据表“movies.csv”，可以分析出所有电影类别下各有哪些电影，以及这些电影各自诞生的年份，将年份与 2000 比较，即可得到上世纪的电影与本世纪的电影，亦即得到以下列表：</p>
<blockquote>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fzhvpq8qqtj306h0i5dgb.jpg" alt="上世纪电影的部分列表"></p>
</blockquote>
<p>其中，第一个元素为电影 ID，第二各元素为该电影所属的类别。</p>
<p>然后通过表“ratings.csv”，可以得到所有电影的平均分，即下表：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fzhvqh8pm1j302505ugli.jpg" alt=""></p>
<p>其中，第一个元素为电影 ID，第二个元素为该电影的平均分。</p>
<p>将第一步得到的 RDD 与第二步得到的 RDD 进行 Join 操作即可分别得到上世纪和本世纪的一个详细列表，如下所示：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fzhvqv17z5j306b07gmx9.jpg" alt=""></p>
<p>这里我们已经不再需要电影 ID 这个元素了，因为我们的目的是提取出所有电影类别及其对应的平均分即可，具体操作为用“|”分割出所有的电影类别，再将同一个电影类别的总分除以该类别出现在不同电影中的次数即可得到该类别的平均分，这里的麻烦之处在于，如何将一个 RDD 中每一行的第一个元素用“|“分割后产生的每个元素与该行的第二个元素即分数相组合成一个新的元组，这里我写了一个专门用了处理这个过程的函数，这个函数会先将第一个元素用”|“分割，再将每个元素与分数组合为一个元组，再将这个元组加入一个事先定义好的列表中，当这个 RDD 的所有行都处理完毕后，用这个列表生成一个新的 RDD，这个新的 RDD 就包含了每个电影类别以及分数，不过这时会有重复的电影类别，之后再用 ReduceByKey 处理一下即可得到各个电影类别的平均分，最终结果如下所示：</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fzhvr34x14j309107ijre.jpg" alt=""></p>
<p>左边为上世纪的结果，右边为本世纪的结果</p>
<h4 id="图表分析与结论"><a href="#图表分析与结论" class="headerlink" title="图表分析与结论"></a>图表分析与结论</h4><p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fzhvs724vhj30di065t8l.jpg" alt=""></p>
<p>通过对比分析不难得出，恐怖片无论在上世纪还是本世纪都是得分最低的，这可能跟恐怖片成本不高，导致滥竽充数的作品很多有关，而上个世纪中得分最高的电影类别为”没有类别“，这看上去有些不合情理，但仔细一想，上个世纪的跨度为 100 年，早期的电影也许无法准确定性为何种流派的电影，而这些作品又确实吸引了一大批观众，将这些作品带上了首席宝座，而这个世纪平均分最高的类别为 Film-Noir，网上给出的翻译为<strong>黑色电影</strong>，我对这方面没有什么研究，感兴趣的同学可以自己分析下这其中的原因。</p>
<h4 id="代码-3"><a href="#代码-3" class="headerlink" title="代码"></a>代码</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.&#123;<span class="type">SparkConf</span>, <span class="type">SparkContext</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line">    <span class="keyword">val</span> conf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">&quot;WordCount&quot;</span>).setMaster(<span class="string">&quot;local&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(conf)</span><br><span class="line">    <span class="keyword">val</span> lines1 = sc.textFile(<span class="string">&quot;D:/BigData/input/ratings.txt&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> lines2 = sc.textFile(<span class="string">&quot;D:/BigData/input/movies.txt&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> movieIds_ratings = lines1.map(line =&gt; (line.split(<span class="string">&quot;,&quot;</span>)(<span class="number">1</span>), line.split(<span class="string">&quot;,&quot;</span>)(<span class="number">2</span>).toDouble))</span><br><span class="line">    <span class="keyword">val</span> ratings = movieIds_ratings.reduceByKey(_ + _)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> movieIds = lines1.map(line =&gt; (line.split(<span class="string">&quot;,&quot;</span>)(<span class="number">1</span>), <span class="number">1</span>))</span><br><span class="line">    <span class="keyword">val</span> movie_num = movieIds.reduceByKey((v1, v2) =&gt; v1 + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> result1 = ratings.join(movie_num)   <span class="comment">// 存储每部电影的平均分(需要计算一下)</span></span><br><span class="line"></span><br><span class="line">    lines2.map(line =&gt; (line.split(<span class="string">&quot;\\&#123;&quot;</span>)(<span class="number">0</span>), line.split(<span class="string">&quot;\\&#123;&quot;</span>)(<span class="number">2</span>), line.split(<span class="string">&quot;\\&#123;&quot;</span>)(<span class="number">1</span>))).foreach(x =&gt; (parseYear(x._1, x._2, x._3)))</span><br><span class="line">    sc.parallelize(ls_lastCentury).join(result1).map(x =&gt; (x._2._1, (x._2._2._1 / x._2._2._2).formatted(<span class="string">&quot;%.2f&quot;</span>))).foreach(x =&gt; parse(x._1, x._2, <span class="number">0</span>))</span><br><span class="line">    sc.parallelize(ls_thisCentury).join(result1).map(x =&gt; (x._2._1, (x._2._2._1 / x._2._2._2).formatted(<span class="string">&quot;%.2f&quot;</span>))).foreach(x =&gt; parse(x._1, x._2, <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> rdd_lastCentury = sc.parallelize(resultLs_lastCentury).reduceByKey((x, y) =&gt; (x._1 + y._1, x._2 +<span class="number">1</span>)).map(x =&gt; (x._1, (x._2._1 / x._2._2).formatted(<span class="string">&quot;%.2f&quot;</span>)))</span><br><span class="line">    <span class="keyword">val</span> rdd_thisCentury = sc.parallelize(resultLs_thisCentury).reduceByKey((x, y) =&gt; (x._1 + y._1, x._2 +<span class="number">1</span>)).map(x =&gt; (x._1, (x._2._1 / x._2._2).formatted(<span class="string">&quot;%.2f&quot;</span>)))</span><br><span class="line"></span><br><span class="line">    rdd_thisCentury.collect.foreach(println)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> resultLs_lastCentury = <span class="type">List</span>((<span class="string">&quot;Test&quot;</span>, (<span class="number">0.0</span>, <span class="number">1</span>)))</span><br><span class="line">  <span class="keyword">var</span> resultLs_thisCentury = <span class="type">List</span>((<span class="string">&quot;Test&quot;</span>, (<span class="number">0.0</span>, <span class="number">1</span>)))</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">parse</span></span>(str:<span class="type">String</span>, rating:<span class="type">String</span>, flag:<span class="type">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (a &lt;- str.split(<span class="string">&quot;\\|&quot;</span>)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (flag == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">val</span> t = <span class="type">Tuple2</span>(a, (rating.toDouble, <span class="number">1</span>))</span><br><span class="line">        resultLs_lastCentury = t :: resultLs_lastCentury</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">val</span> t = <span class="type">Tuple2</span>(a, (rating.toDouble, <span class="number">1</span>))</span><br><span class="line">        resultLs_thisCentury = t :: resultLs_thisCentury</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> ls_lastCentury = <span class="type">List</span>((<span class="string">&quot;Test&quot;</span>, <span class="string">&quot;Test&quot;</span>))</span><br><span class="line">  <span class="keyword">var</span> ls_thisCentury = <span class="type">List</span>((<span class="string">&quot;Test&quot;</span>, <span class="string">&quot;Test&quot;</span>))</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">parseYear</span></span>(str1:<span class="type">String</span>, str2:<span class="type">String</span>, str3:<span class="type">String</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">if</span> (str3.split(<span class="string">&quot;`&quot;</span>).length == <span class="number">2</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="type">Integer</span>.parseInt(str3.split(<span class="string">&quot;`&quot;</span>)(<span class="number">1</span>).substring(<span class="number">0</span>, <span class="number">4</span>)) &lt; <span class="number">2000</span>) &#123;</span><br><span class="line">        <span class="keyword">val</span> t = <span class="type">Tuple2</span>(str1, str2)</span><br><span class="line">        ls_lastCentury = t :: ls_lastCentury</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">val</span> t = <span class="type">Tuple2</span>(str1, str2)</span><br><span class="line">        ls_thisCentury = t :: ls_thisCentury</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="各分数段的电影数量与年代的关系"><a href="#各分数段的电影数量与年代的关系" class="headerlink" title="各分数段的电影数量与年代的关系"></a>各分数段的电影数量与年代的关系</h3><p>数据源中的电影评分最低为 0，最高为 5，因此我将其从 0~0.5 开始分为了 10 各分数段，分析了各分数段的电影数量与年代的关系，另外，由于数据源中最早的电影为 18 世纪 90 年代，为了方便，我将 20 年定义为一个年代，因此至今共有 7 个年代。</p>
<h4 id="分析思路-7"><a href="#分析思路-7" class="headerlink" title="分析思路"></a>分析思路</h4><p>工具：MapReduce。</p>
<p>通过表“ratings.csv”，可以分析出所有电影的平均分，并以第一个元素为电影 ID，第二个元素为平均分组成一个列表，写入文件 movieQuality1.txt 中，如下所示：</p>
<blockquote>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fzhw6q05o3j304c08djrc.jpg" alt=""></p>
</blockquote>
<p>根据事先定义好的分数段，可以将目前算出的所有平均分都放入一个分数段中，再统计出每个分数段中各有哪些电影，如图所示：</p>
<blockquote>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fzhw6zaxyrj30cr0610u0.jpg" alt=""></p>
</blockquote>
<p>由于电影的数量很多，因此每个分数段后面都有很多的电影 ID。</p>
<p>目前只统计出了各分数段下的电影，但还不知道这些电影都属于什么年代，因此这里需要用到另一张表“movies.csv”，再新建一个 MapReduce，读入这张表以及上一步生成的文件，扫描每个分数段中的电影 ID，定位到表“movies.csv“相对应的电影 ID，再获取相应的电影名，从名字中提取出年份信息，再将其定位到相应年代，即可分析出各分数段中每个年代的电影数量，最终可以得到下面所示的列表：</p>
<blockquote>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fzhw7dv3vwj305l03l747.jpg" alt=""></p>
</blockquote>
<p>其中，第一列为分数段，方便起见，我将分数段用 0.1 到 1 代替，后面的每一列都依次代表了一个年代的电影数量。</p>
<h4 id="图表分析与结论-1"><a href="#图表分析与结论-1" class="headerlink" title="图表分析与结论"></a>图表分析与结论</h4><p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fzhw7tuz94j30wc0he0w2.jpg" alt=""></p>
<p>不难看出，1990~2010 年间，世界上涌现出了很多优秀的电影作品，无论从电影数量还是质量来说，1990~2010 都是电影史上的一个黄金时期。另外，由于 2010 年至今只有 8 年，因此电影数量看起来比较低。</p>
<h4 id="代码-4"><a href="#代码-4" class="headerlink" title="代码"></a>代码</h4><ol>
<li><p>MovieQuality1</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> movie_program;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FileSystem;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">movieQuality1</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">RMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">Text</span>&gt; </span>&#123;</span><br><span class="line">		</span><br><span class="line">		Text ktext = <span class="keyword">new</span> Text(<span class="string">&quot;&quot;</span>);</span><br><span class="line">		Text vtext = <span class="keyword">new</span> Text(<span class="string">&quot;&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, Text value, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">			String[] strs = value.toString().split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">			String movieId = strs[<span class="number">1</span>];</span><br><span class="line">			String rating = strs[<span class="number">2</span>];</span><br><span class="line">			ktext.set(movieId);</span><br><span class="line">			vtext.set(rating);</span><br><span class="line">			context.write(ktext, vtext);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">RReducer</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>,<span class="title">Text</span>,<span class="title">Text</span>,<span class="title">Text</span>&gt; </span>&#123;</span><br><span class="line">		</span><br><span class="line">		Text vtext = <span class="keyword">new</span> Text(<span class="string">&quot;&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key,Iterable&lt;Text&gt; values,Context context)</span> <span class="keyword">throws</span> IOException,InterruptedException </span>&#123;</span><br><span class="line">			<span class="keyword">double</span> sum = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">for</span>(Text val:values) &#123;</span><br><span class="line">				sum += Double.parseDouble(val.toString());</span><br><span class="line">				num++;</span><br><span class="line">			&#125;</span><br><span class="line">			vtext.set(String.valueOf(sum / num));</span><br><span class="line">			context.write(key, vtext);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * input: /data/movie_program/rating/ratings.txt</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (args.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">			System.out.println(<span class="string">&quot;Usage:&lt;inputPath&gt;&lt;outputPath&gt;&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">		</span><br><span class="line">		FileSystem fs = FileSystem.get(conf);</span><br><span class="line">		</span><br><span class="line">		Path inputPath = <span class="keyword">new</span> Path(args[<span class="number">0</span>]);</span><br><span class="line">		Path outputPath = <span class="keyword">new</span> Path(args[<span class="number">1</span>]);</span><br><span class="line">		<span class="keyword">if</span> (fs.exists(outputPath)) &#123;</span><br><span class="line">			fs.delete(outputPath, <span class="keyword">true</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		Job job = Job.getInstance(conf);</span><br><span class="line">		job.setJobName(<span class="string">&quot;movieQuality1&quot;</span>);</span><br><span class="line">		job.setJarByClass(movieQuality1.class);</span><br><span class="line">		</span><br><span class="line">		job.setMapperClass(RMapper.class);</span><br><span class="line">		job.setReducerClass(RReducer.class);</span><br><span class="line">        </span><br><span class="line">		job.setOutputKeyClass(Text.class);</span><br><span class="line">        job.setOutputValueClass(Text.class);</span><br><span class="line"></span><br><span class="line">        FileInputFormat.setInputPaths(job, inputPath);	</span><br><span class="line">        FileOutputFormat.setOutputPath(job, outputPath);</span><br><span class="line">		</span><br><span class="line">		job.waitForCompletion(<span class="keyword">true</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>MovieQuality2</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> movie_program;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.text.DecimalFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FileSystem;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">movieQuality2</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">RMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">Text</span>&gt; </span>&#123;</span><br><span class="line">		</span><br><span class="line">		Text ktext = <span class="keyword">new</span> Text(<span class="string">&quot;&quot;</span>);</span><br><span class="line">		Text vtext = <span class="keyword">new</span> Text(<span class="string">&quot;&quot;</span>);</span><br><span class="line">		<span class="keyword">double</span> rank = <span class="number">0</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, Text value, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">			String[] strs = value.toString().split(<span class="string">&quot;	&quot;</span>);	</span><br><span class="line">			String movieId = strs[<span class="number">0</span>];</span><br><span class="line">			String rating = strs[<span class="number">1</span>];</span><br><span class="line">			rank = Double.parseDouble(rating) / <span class="number">5</span>;</span><br><span class="line">			<span class="keyword">if</span>(Double.parseDouble(rating) / <span class="number">5</span> == <span class="number">0</span>) &#123;</span><br><span class="line">				rank -= <span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			DecimalFormat df = <span class="keyword">new</span> DecimalFormat(<span class="string">&quot;#.0&quot;</span>);</span><br><span class="line">			rank = Double.parseDouble(df.format(rank));</span><br><span class="line">			ktext.set(String.valueOf(rank));</span><br><span class="line">			vtext.set(movieId);</span><br><span class="line">			context.write(ktext, vtext);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">RReducer</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>,<span class="title">Text</span>,<span class="title">Text</span>,<span class="title">Text</span>&gt; </span>&#123;</span><br><span class="line">		</span><br><span class="line">		Text ktext = <span class="keyword">new</span> Text(<span class="string">&quot;&quot;</span>);</span><br><span class="line">		Text vtext = <span class="keyword">new</span> Text(<span class="string">&quot;&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key,Iterable&lt;Text&gt; values,Context context)</span> <span class="keyword">throws</span> IOException,InterruptedException </span>&#123;</span><br><span class="line">			String movieIds = <span class="string">&quot;&quot;</span>;</span><br><span class="line">			<span class="keyword">for</span>(Text val:values) &#123;</span><br><span class="line">				movieIds += val.toString() + <span class="string">&quot; &quot;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			vtext.set(movieIds);</span><br><span class="line">			context.write(key, vtext);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * input: /data/movie_program/output/movieQuality1/part-r-00000</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (args.length &lt; <span class="number">2</span>) &#123;</span><br><span class="line">			System.out.println(<span class="string">&quot;Usage:&lt;inputPath&gt;&lt;outputPath&gt;&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">		</span><br><span class="line">		FileSystem fs = FileSystem.get(conf);</span><br><span class="line">		</span><br><span class="line">		Path inputPath = <span class="keyword">new</span> Path(args[<span class="number">0</span>]);</span><br><span class="line">		Path outputPath = <span class="keyword">new</span> Path(args[<span class="number">1</span>]);</span><br><span class="line">		<span class="keyword">if</span> (fs.exists(outputPath)) &#123;</span><br><span class="line">			fs.delete(outputPath, <span class="keyword">true</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		Job job = Job.getInstance(conf);</span><br><span class="line">		job.setJobName(<span class="string">&quot;movieQuanlity2&quot;</span>);</span><br><span class="line">		job.setJarByClass(movieQuality2.class);</span><br><span class="line">		</span><br><span class="line">		job.setMapperClass(RMapper.class);</span><br><span class="line">		job.setReducerClass(RReducer.class);</span><br><span class="line">        </span><br><span class="line">		job.setOutputKeyClass(Text.class);</span><br><span class="line">        job.setOutputValueClass(Text.class);</span><br><span class="line"></span><br><span class="line">        FileInputFormat.setInputPaths(job, inputPath);	</span><br><span class="line">        FileOutputFormat.setOutputPath(job, outputPath);</span><br><span class="line">		</span><br><span class="line">		job.waitForCompletion(<span class="keyword">true</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>MovieQuality3</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> movie_program;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> movie_program.Rating3.Rating2Mapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.conf.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.FileSystem;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.fs.Path;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.LongWritable;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.io.Text;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Job;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.Reducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;</span><br><span class="line"><span class="keyword">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">movieQuality3</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">RMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">Text</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">		Map&lt;String,String&gt; movieInfoMap = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">        Text ktext = <span class="keyword">new</span> Text(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        Text vtext = <span class="keyword">new</span> Text(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">setup</span><span class="params">(Mapper&lt;LongWritable, Text, Text, Text&gt;.Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">            BufferedReader br = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(<span class="keyword">new</span> FileInputStream(<span class="string">&quot;/home/cloudera/Desktop/movies.txt&quot;</span>)));</span><br><span class="line">            String line;</span><br><span class="line">            String movieId = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            String movieYear = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">while</span>(StringUtils.isNotEmpty(line = br.readLine())) &#123;</span><br><span class="line">                String[] strs = line.split(<span class="string">&quot;\\&#123;&quot;</span>);	<span class="comment">// example: 3 1</span></span><br><span class="line">                movieId = strs[<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">if</span>(strs[<span class="number">1</span>].contains(<span class="string">&quot;`&quot;</span>)) &#123;</span><br><span class="line">    				movieYear = strs[<span class="number">1</span>].substring(strs[<span class="number">1</span>].indexOf(<span class="string">&quot;`&quot;</span>) + <span class="number">1</span>, strs[<span class="number">1</span>].indexOf(<span class="string">&quot;`&quot;</span>) + <span class="number">5</span>);	<span class="comment">// example: 1995</span></span><br><span class="line">    				movieInfoMap.put(movieId, movieYear);	<span class="comment">// example: &#123;(&quot;1&quot;,&quot;1995&quot;)&#125;	(movieId, year)</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, Text value, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">			<span class="keyword">int</span>[] num_eachTwoDecades = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">7</span>];</span><br><span class="line">			<span class="keyword">int</span> decade = <span class="number">0</span>;</span><br><span class="line">			</span><br><span class="line">			String[] strs = value.toString().split(<span class="string">&quot;	&quot;</span>);	<span class="comment">// rank movieIds </span></span><br><span class="line">			String rank = strs[<span class="number">0</span>];</span><br><span class="line">			String movieId_str = strs[<span class="number">1</span>];</span><br><span class="line">			String[] movieIds = movieId_str.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">			String movieYear = <span class="string">&quot;&quot;</span>;</span><br><span class="line">			<span class="keyword">for</span>(String movieId:movieIds) &#123;</span><br><span class="line">				movieYear = movieInfoMap.get(movieId);</span><br><span class="line">				<span class="keyword">if</span>(movieYear != <span class="keyword">null</span>) &#123;</span><br><span class="line">					decade = (Integer.parseInt(movieYear) - <span class="number">1890</span>) / <span class="number">20</span>;</span><br><span class="line">					num_eachTwoDecades[decade] ++;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			ktext.set(rank);</span><br><span class="line">			vtext.set(num_eachTwoDecades[<span class="number">0</span>] + <span class="string">&quot; &quot;</span> + num_eachTwoDecades[<span class="number">1</span>] + <span class="string">&quot; &quot;</span> + num_eachTwoDecades[<span class="number">2</span>] + <span class="string">&quot; &quot;</span> + num_eachTwoDecades[<span class="number">3</span>] + <span class="string">&quot; &quot;</span></span><br><span class="line">					+ num_eachTwoDecades[<span class="number">4</span>] + <span class="string">&quot; &quot;</span> + num_eachTwoDecades[<span class="number">5</span>] + <span class="string">&quot; &quot;</span> + num_eachTwoDecades[<span class="number">6</span>]);</span><br><span class="line">			context.write(ktext, vtext);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * input: /data/movie_program/output/movieQuality2/part-r-00000</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">        Job job = Job.getInstance(conf);</span><br><span class="line">        job.setJarByClass(movieQuality3.class);</span><br><span class="line">        job.setMapperClass(RMapper.class);</span><br><span class="line">        job.setOutputKeyClass(Text.class);</span><br><span class="line">        job.setOutputValueClass(Text.class);</span><br><span class="line">        FileInputFormat.setInputPaths(job, <span class="keyword">new</span> Path(args[<span class="number">0</span>]));</span><br><span class="line">        FileSystem fs = FileSystem.get(conf);</span><br><span class="line">        Path path = <span class="keyword">new</span> Path(args[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">if</span>(fs.isDirectory(path))&#123;</span><br><span class="line">            fs.delete(path, <span class="keyword">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(args[<span class="number">1</span>]));</span><br><span class="line">        job.setNumReduceTasks(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">boolean</span> res =job.waitForCompletion(<span class="keyword">true</span>);</span><br><span class="line">        System.exit(res?<span class="number">1</span>:<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="其他角度"><a href="#其他角度" class="headerlink" title="其他角度"></a>其他角度</h2></li>
</ol>
<h3 id="电影评分与受关注度（体现在评分用户数）的关系"><a href="#电影评分与受关注度（体现在评分用户数）的关系" class="headerlink" title="电影评分与受关注度（体现在评分用户数）的关系"></a>电影评分与受关注度（体现在评分用户数）的关系</h3><p>一部电影可能会被多个用户评分，那么一部电影的平均得分和给它评分的用户数是否有关系呢，换句话说，是不是电影越出名，它就越有可能得高分呢？</p>
<h4 id="思路分析"><a href="#思路分析" class="headerlink" title="思路分析"></a>思路分析</h4><p>这个分析方向其实比较简单，因为之用到了一张表的两列，因此思路也很简单。</p>
<p>首先提取出表“ratings.csv”的第二列和第三列，即 movieId 列和 rating 列，存储在一个 RDD 中，然后通过 <code>ReduceByKey</code> 并稍加运算即可得到每部电影的平均分和被评论的次数，具体代码也就两行，最后即可得到以下结果：</p>
<blockquote>
<p><img src="http://oom3nz471.bkt.clouddn.com/43.jpg" alt="1530863023819"></p>
</blockquote>
<p>其中，第一列为一部电影被评论的次数，第二列为该电影的平均分。</p>
<h4 id="图表分析与结论-2"><a href="#图表分析与结论-2" class="headerlink" title="图表分析与结论"></a>图表分析与结论</h4><p><img src="http://oom3nz471.bkt.clouddn.com/44.jpg" alt="1530863072337"></p>
<p>如图所示，横轴代表分数，纵轴代表被评分的次数，正如图中黑色的线所示，随着评分次数的增加，分数是有一个增加的趋势的，但是波动比较大，因为一部电影除了因为拍的很好导致大家都想去评分外，也可能是因为拍的很烂，但还是前者的可能性大一些，从而产生了图中的趋势，当然这只是一部分的原因。但总的来说，一部电影越出名，它的分数越高的可能性是比较大的。</p>
<h4 id="代码-5"><a href="#代码-5" class="headerlink" title="代码"></a>代码</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.&#123;<span class="type">SparkConf</span>, <span class="type">SparkContext</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> conf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">&quot;WordCount&quot;</span>).setMaster(<span class="string">&quot;local&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(conf)</span><br><span class="line">    <span class="keyword">val</span> lines = sc.textFile(<span class="string">&quot;D:/BigData/input/ratings.txt&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> movieIds = lines.map(line =&gt; (line.split(<span class="string">&quot;,&quot;</span>)(<span class="number">1</span>), line.split(<span class="string">&quot;,&quot;</span>)(<span class="number">2</span>))).map(x =&gt; (x._1, (x._2.toDouble, <span class="number">1</span>)))</span><br><span class="line">    <span class="keyword">val</span> output = movieIds.reduceByKey((x, y) =&gt; (x._1 + y._1, x._2 + <span class="number">1</span>)).map(x =&gt; (x._2._2, (x._2._1 / x._2._2).formatted(<span class="string">&quot;%.2f&quot;</span>)))</span><br><span class="line">    output.collect.foreach(println)</span><br><span class="line"></span><br><span class="line">    sc.stop()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="用户一般看电影的时段"><a href="#用户一般看电影的时段" class="headerlink" title="用户一般看电影的时段"></a>用户一般看电影的时段</h3><h4 id="分析思路-8"><a href="#分析思路-8" class="headerlink" title="分析思路"></a>分析思路</h4><p>通过分析用户在网上评论电影的时间可以推断出用户看电影的时间，从而可以得出一些商业价值的信息。比如网站在哪些时间段投放较多广告收益最高，网站在哪些时间段更新电影信息获得流量最高等等。</p>
<h4 id="代码-6"><a href="#代码-6" class="headerlink" title="代码"></a>代码</h4><ol>
<li><p>首先转换时间戳为方便人读的时间：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tranTimeToString</span></span>(tm:<span class="type">String</span>) :<span class="type">String</span>=&#123;</span><br><span class="line">  <span class="keyword">val</span> fm = <span class="keyword">new</span> <span class="type">SimpleDateFormat</span>(<span class="string">&quot;HH&quot;</span>)</span><br><span class="line">  <span class="keyword">val</span> tim = fm.format(<span class="keyword">new</span> <span class="type">Date</span>(tm.toLong))</span><br><span class="line">  tim</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>然后分割数据并且对数据进行累加，得出结论：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> result = rdd.map(x =&gt; (tranTimeToString(x.split(<span class="string">&quot;**\&#123;&quot;</span>)						(<span class="number">3</span>)+<span class="string">&quot;000&quot;</span>**),<span class="number">1</span>)).reduceByKey((x,y)=&gt;x+y).sortByKey()</span><br></pre></td></tr></table></figure>
<p><strong>完整代码</strong></p>
</li>
</ol>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.&#123;<span class="type">SparkConf</span>, <span class="type">SparkContext</span>&#125;</span><br><span class="line"><span class="keyword">import</span> java.text.<span class="type">SimpleDateFormat</span></span><br><span class="line"><span class="keyword">import</span> java.util.<span class="type">Date</span></span><br><span class="line"><span class="keyword">import</span> java.io.<span class="type">File</span></span><br><span class="line"><span class="keyword">import</span> java.io.<span class="type">PrintWriter</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TimeTurn</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> conf = <span class="keyword">new</span> <span class="type">SparkConf</span>().setAppName(<span class="string">&quot;TimeTurn&quot;</span>).setMaster(<span class="string">&quot;local&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(conf)</span><br><span class="line">    <span class="keyword">val</span> rdd = sc.textFile(<span class="string">&quot;C:\\Users\\iprcc\\Desktop\\movie\\tags5.txt&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> result = rdd.map(x =&gt; (tranTimeToString(x.split(<span class="string">&quot;\\&#123;&quot;</span>)(<span class="number">3</span>)+<span class="string">&quot;000&quot;</span>),<span class="number">1</span>)).reduceByKey((x,y)=&gt;x+y).sortByKey()</span><br><span class="line">    println(result.collect().mkString(<span class="string">&quot;\n&quot;</span>))</span><br><span class="line">    <span class="keyword">val</span> writer = <span class="keyword">new</span> <span class="type">PrintWriter</span>(<span class="keyword">new</span> <span class="type">File</span>(<span class="string">&quot;C:\\Users\\iprcc\\Desktop\\movie\\result2.txt&quot;</span>))</span><br><span class="line">    writer.println(result.collect().mkString(<span class="string">&quot;\n&quot;</span>))</span><br><span class="line">    writer.close()</span><br><span class="line">  &#125;</span><br><span class="line">    </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">tranTimeToString</span></span>(tm:<span class="type">String</span>) :<span class="type">String</span>=&#123;</span><br><span class="line">    <span class="keyword">val</span> fm = <span class="keyword">new</span> <span class="type">SimpleDateFormat</span>(<span class="string">&quot;HH&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> tim = fm.format(<span class="keyword">new</span> <span class="type">Date</span>(tm.toLong))</span><br><span class="line">    tim</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="图表-4"><a href="#图表-4" class="headerlink" title="图表"></a>图表</h4><p><img src="http://oom3nz471.bkt.clouddn.com/45.jpg" alt="img"> </p>
<h4 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h4><p>人们喜欢在北京时间3到5点的时候上网评论电影，转换成当地时间大概是下午4点前后流量最多。说明人们多喜欢在下午看电影。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><h2 id="各流派的电影数量"><a href="#各流派的电影数量" class="headerlink" title="各流派的电影数量"></a>各流派的电影数量</h2><p><img src="http://oom3nz471.bkt.clouddn.com/3.jpg" alt="img"> </p>
<p><img src="http://oom3nz471.bkt.clouddn.com/4.jpg" alt="img"></p>
<p>从各流派电影数图来看，电影数最多的是Drama类，电影数最少的是IMAX类。我们猜测，IMAX技术出现比较晚，受年代限制所以这类电影数量比较少，除IMAX类之外最少的是Film-Noir（黑色电影）类。</p>
<h2 id="各流派得分随时间的变化-1"><a href="#各流派得分随时间的变化-1" class="headerlink" title="各流派得分随时间的变化"></a>各流派得分随时间的变化</h2><p><img src="http://oom3nz471.bkt.clouddn.com/8.jpg" alt="1530875595962"></p>
<p>上图包含了很多信息，可以从很多角度进行分析。比如，恐怖片的质量看上去越来越差强人意了，犯罪主题的电影似乎也越来越不合人的胃口，但又比恐怖片好一些。纪录片似乎质量一直不错，枪战片的质量在上世纪七八十年代似乎很不错，另外，似乎所有流派的电影质量都有所下滑，这也许是人们已经厌倦了现代的好莱坞式商业电影大行于世导致的。</p>
<h2 id="高分电影中的比较多的标签-1"><a href="#高分电影中的比较多的标签-1" class="headerlink" title="高分电影中的比较多的标签"></a>高分电影中的比较多的标签</h2><p><img src="http://oom3nz471.bkt.clouddn.com/14.jpg" alt="img"></p>
<p>根据图表可知，高分电影中标签数量最多的是imdb top 250，说明imdb的电影排行榜还是很靠谱的，其排行榜上的电影也是movielens网站中用户给高分最多的；排名第二的为hitchcock，这是一个知名的导演的名字，他的代表作为<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%90%8E%E7%AA%97">后窗</a>、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%83%8A%E9%AD%82%E8%AE%B0">惊魂记</a>、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E8%A5%BF%E5%8C%97%E5%81%8F%E5%8C%97">西北偏北</a>、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E8%9D%B4%E8%9D%B6%E6%A2%A6">蝴蝶梦</a>、<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%88%97%E8%BD%A6%E4%B8%8A%E7%9A%84%E9%99%8C%E7%94%9F%E4%BA%BA">列车上的陌生人</a>等，曾获得过奥斯卡奖终身成就奖，高分电影中以这位导演为标签的数目比较多，说明这位大众对这位导演的电影都有很高的评价；排名第三的为criterion标准，说明大众给标准化的电影打分也是可观的；排名第四的为oscar（best picture）奥斯卡最佳影片，说明奥斯卡评出来的电影是很权威的，也是符合大众口味的；第五名为Screwball comedy疯狂喜剧，之后又接着两个与奥斯卡相关的，看来奥斯卡评出的电影确实是很不错的电影，不论是对专家还是对看电影的用户来说。</p>
<h2 id="电影得分与标签数量之间的关系-1"><a href="#电影得分与标签数量之间的关系-1" class="headerlink" title="电影得分与标签数量之间的关系"></a>电影得分与标签数量之间的关系</h2><p><img src="http://oom3nz471.bkt.clouddn.com/20.jpg" alt="img"></p>
<p><img src="http://oom3nz471.bkt.clouddn.com/21.jpg" alt="img"></p>
<p>由上面的图表可以看出标签数量较多的集中在大致在电影得分在3.5-4.0范围之间，而标签数量大致随电影得分的增高而增长，在4.0到5.0之间这个趋势有点减弱，这个分数阶段的标签数量相对与3.5-4.0之间要少许多；就此分析，我们可以推论得分3.5-4.0的电影可能更被人熟知，被更多的人评论，从而贴上更多的标签，剧情各方面的综合性比较强；而可能得分0-4.0的电影不怎么符合大众的口味，或者剧情各方面经不起推敲，接近烂片的标准；至于得分4.0-5.0的电影属于被人遗忘的佳作的类型，亦或是佳作根本无需贴标签，只需要静静欣赏的类型。</p>
<h2 id="电影数量与年代变化之间的关系-1"><a href="#电影数量与年代变化之间的关系-1" class="headerlink" title="电影数量与年代变化之间的关系"></a>电影数量与年代变化之间的关系</h2><p><img src="http://oom3nz471.bkt.clouddn.com/22.jpg" alt="img"></p>
<p>从时间来看，如图所示，从1891年开始到2017年，上映的电影数量整体趋势上涨。在18世纪末，电影行业应该才刚刚起步，电影数量非常少，而到了十九世纪，电影逐渐增加，特别是到了19世纪末，电影数量开始飞速增长，到了20世纪，十几年内电影数量已经达到了14000万以上。</p>
<h2 id="各流派的电影数量随年代的变化趋势"><a href="#各流派的电影数量随年代的变化趋势" class="headerlink" title="各流派的电影数量随年代的变化趋势"></a>各流派的电影数量随年代的变化趋势</h2><p><img src="http://oom3nz471.bkt.clouddn.com/23.jpg" alt="img"><br><img src="http://oom3nz471.bkt.clouddn.com/24.jpg" alt="img"></p>
<p>由图1可看出在电影史上drama类型的电影数量一直处于上升趋势，很多电影喜欢加入drama的因素在其中，也说明市场一直需要drama类型的电影。但是由图2知在2011年之后drama类型的电影出现了陡然下降的趋势，其原因可能是drama类型的电影的关注开始降低，也可能是由于整体电影市场中电影数量的减少导致。</p>
<p>虽然在整个电影史上电影的总数量呈极速增长的趋势，但是在2011年之后几乎所有类型的电影的数量都开始减少。经分析，其原因可能是：1、电影的类型开始不多元化（如果一个电影有多个类型标签，则通过此统计算出的此类型的电影数量会变多）2、电影拍摄数量确实开始减少，可能是因为电影拍摄成本升高的原因3、电影市场需求量减少。总而言之，电影圈的竞争越来越激烈。</p>
<p>从图2我们还可以看出只有IMAX类型的电影处于增长趋势，这说明今后此技术的电影需求量在上升。</p>
<h2 id="不同年代的拥有电影数量最多的电影流派"><a href="#不同年代的拥有电影数量最多的电影流派" class="headerlink" title="不同年代的拥有电影数量最多的电影流派"></a>不同年代的拥有电影数量最多的电影流派</h2><p><img src="http://oom3nz471.bkt.clouddn.com/25.jpg" alt="img"><br><img src="http://oom3nz471.bkt.clouddn.com/26.jpg" alt="img"><br><img src="http://oom3nz471.bkt.clouddn.com/27.jpg" alt="img"><br><img src="http://oom3nz471.bkt.clouddn.com/28.jpg" alt="img"><br><img src="http://oom3nz471.bkt.clouddn.com/29.jpg" alt="img"><br><img src="http://oom3nz471.bkt.clouddn.com/30.jpg" alt="img"></p>
<p>60、70、80年代Drama、conmedy和action的电影类型数量最多，90年代之后thriller类型替换了action进入了前三。</p>
<p>戏剧与喜剧一直高居榜首可见这两个类型是大多数电影的主要元素，市场欢迎程度最高，这也说明了大多数人看电影主要是为了娱乐和放松，也揭示了电影最主要的功能是娱乐大众。</p>
<p>在90年代以后，恐怖片的数量超过动作片，可以说明恐怖片的市场在增长，可能是因为人们开始更多寻求心理上的刺激。</p>
<h2 id="上世纪与本世纪比较受欢迎的电影类别-1"><a href="#上世纪与本世纪比较受欢迎的电影类别-1" class="headerlink" title="上世纪与本世纪比较受欢迎的电影类别"></a>上世纪与本世纪比较受欢迎的电影类别</h2><p><img src="http://oom3nz471.bkt.clouddn.com/37.jpg" alt="img"><br><img src="http://oom3nz471.bkt.clouddn.com/38.jpg" alt="img"></p>
<p>通过对比分析不难得出，恐怖片无论在上世纪还是本世纪都是得分最低的，这可能跟恐怖片成本不高，导致滥竽充数的作品很多有关，而上个世纪中得分最高的电影类别为”没有类别“，这看上去有些不合情理，但仔细一想，上个世纪的跨度为 100 年，早期的电影也许无法准确定性为何种流派的电影，而这些作品又确实吸引了一大批观众，将这些作品带上了首席宝座，而这个世纪平均分最高的类别为 Film-Noir，网上给出的翻译为<strong>黑色电影</strong>，我对这方面没有什么研究，感兴趣的同学可以自己分析下这其中的原因。</p>
<h2 id="各分数段的电影数量与年代的关系-1"><a href="#各分数段的电影数量与年代的关系-1" class="headerlink" title="各分数段的电影数量与年代的关系"></a>各分数段的电影数量与年代的关系</h2><p><img src="http://oom3nz471.bkt.clouddn.com/42.jpg" alt="img"></p>
<p>不难看出，1990~2010 年间，世界上涌现出了很多优秀的电影作品，无论从电影数量还是质量来说，1990~2010 都是电影史上的一个黄金时期。另外，由于 2010 年至今只有 8 年，因此电影数量看起来比较低。</p>
<h2 id="电影评分与受关注度（体现在评分用户数）的关系-1"><a href="#电影评分与受关注度（体现在评分用户数）的关系-1" class="headerlink" title="电影评分与受关注度（体现在评分用户数）的关系"></a>电影评分与受关注度（体现在评分用户数）的关系</h2><p><img src="http://oom3nz471.bkt.clouddn.com/44.jpg" alt="img"></p>
<p>如图所示，横轴代表分数，纵轴代表被评分的次数，正如图中黑色的线所示，随着评分次数的增加，分数是有一个增加的趋势的，但是波动比较大，因为一部电影除了因为拍的很好导致大家都想去评分外，也可能是因为拍的很烂，但还是前者的可能性大一些，从而产生了图中的趋势，当然这只是一部分的原因。但总的来说，一部电影越出名，它的分数越高的可能性是比较大的。</p>
<h2 id="用户一般看电影的时段-1"><a href="#用户一般看电影的时段-1" class="headerlink" title="用户一般看电影的时段"></a>用户一般看电影的时段</h2><p><img src="http://oom3nz471.bkt.clouddn.com/45.jpg" alt="img"></p>
<p>从各流派电影数图来看，电影数最多的是Drama类，电影数最少的是IMAX类。我们猜测，IMAX技术出现比较晚，受年代限制所以这类电影数量比较少，除IMAX类之外最少的是Film-Noir（黑色电影）类。</p>
<h2 id="各流派内电影得分榜top10-1"><a href="#各流派内电影得分榜top10-1" class="headerlink" title="各流派内电影得分榜top10"></a>各流派内电影得分榜top10</h2><p>结论即图表</p>
<ol>
<li><p><strong>冒险片 Adventure 排行榜</strong></p>
<p> <img src="http://oom3nz471.bkt.clouddn.com/9.jpg" alt="img"></p>
</li>
<li><p><strong>喜剧片 Comedy 排行榜</strong></p>
<p> <img src="http://oom3nz471.bkt.clouddn.com/10.jpg" alt="img"></p>
</li>
<li><p><strong>爱情片 Romance 排行榜</strong></p>
<p> <img src="http://oom3nz471.bkt.clouddn.com/11.jpg" alt="img"></p>
</li>
<li><p><strong>恐怖片 Thriller 排行榜</strong></p>
<p> <img src="http://oom3nz471.bkt.clouddn.com/12.jpg" alt="img"></p>
</li>
</ol>
	  
	</div>

	<!-- recommended posts -->
	

	<div>
  	<center>
	<div class="pagination">
<ul class="pagination">
	 
				
    	<li class="prev"><a href="/2019/01/03/2019/1 优化算法/1 Mini-Batch 梯度下降/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i>Prev</a></li>
  		

        <li><a href="/archives"><i class="fa fa-archive"></i>Archive</a></li>

		
		   <li class="next"><a href="/2018/03/05/2018/年终总结与新年展望/" class="alignright next">Next<i class="fa fa-arrow-circle-o-right"></i></a></li>         
        
	
</ul>
</div>

    </center>
	</div>

    <!-- share -->
    
        

        

    
	
	<!-- comment -->
	
<section id="comment">
  <h2 class="title">Comments</h2>
  
</section>


	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2018-07-07 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/技术/">技术<span>36</span></a></li> <li><a href="/categories/技术/大数据/">大数据<span>1</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/大数据/">大数据<span>1</span></a></li>
    </ul>
	</div>
	

	<!-- toc -->
	<div class="meta-widget">
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>
		

</div><!-- row -->



      
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        processEscapes: true
      }
    });
  </script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
        tex2jax: {
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
  </script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
          var all = MathJax.Hub.getAllJax(), i;
          for(i=0; i < all.length; i += 1) {
              all[i].SourceElement().parentNode.className += ' has-jax';
          }
      });
  </script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

    </div>
  </div>
  <div class="container-narrow">
    <footer> <p>
  &copy; 2021 LiuHDme
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a target="_blank" rel="noopener" href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>.    
</p> </footer>
  </div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="<%- config.root %>js/jquery.imagesloaded.min.js"></script>
<script src="<%- config.root %>js/gallery.js"></script>
<script src="<%- config.root %>js/bootstrap.min.js"></script>
<script src="<%- config.root %>js/main.js"></script>
<script src="<%- config.root %>js/search.js"></script> 

<% if (theme.fancybox){ %>
<link rel="stylesheet" href="<%- config.root %>fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="<%- config.root %>fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>
<% } %>

<% if (config.search) { %>
   <script type="text/javascript">      
     var search_path = "<%= config.search.path %>";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "<%= config.root %>" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>
<% } %>

<!-- syntax highlighting -->
<% if (theme.comment_js) { %>
  <script>
  marked.setOptions({
    highlight: function (code, lang) {
        return hljs.highlightAuto(code).value;
    }
  });
  function Highlighting(){
    var markdowns = document.getElementsByClassName('markdown');
    for(var i=0;i<markdowns.length;i++){
        if(markdowns[i].innerHTML) markdowns[i].innerHTML =marked(markdowns[i].innerHTML);
    }
  }
  window.addEventListener('DOMContentLoaded', Highlighting, false);
  window.addEventListener('load', Highlighting, false);
  </script>
<% } %>

<% if (page.mathjax){ %>
<%- partial('mathjax') %>
<% } %>

</body>
</html>